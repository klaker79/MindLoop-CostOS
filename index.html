<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>La Caleta 102 - Dashboard de Costes</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Montserrat', sans-serif;
      background: linear-gradient(135deg, #c35a3f 0%, #d47157 100%);
      min-height: 100vh;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .header {
      background: white;
      padding: 20px;
      border-radius: 10px;
      margin-bottom: 20px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      gap: 15px;
    }
    .logo-circle {
      width: 50px;
      height: 50px;
      border: 2px solid #c35a3f;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #c35a3f;
    }
    .header-title { flex: 1; }
    .header-title h1 { color: #c35a3f; font-size: 24px; font-weight: 700; }
    .header-title p { color: #666; font-size: 14px; }
    
    .main-card {
      background: white;
      border-radius: 10px;
      padding: 30px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
    }
    .top-bar h2 { font-size: 28px; color: #333; }
    .top-bar p { color: #666; font-size: 14px; margin-top: 5px; }
    
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-family: 'Montserrat', sans-serif;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.3s;
    }
    .btn-primary {
      background: #c35a3f;
      color: white;
    }
    .btn-primary:hover { background: #a84a33; }
    .btn-secondary {
      background: #f0f0f0;
      color: #333;
    }
    .btn-secondary:hover { background: #e0e0e0; }
    
    .search-box {
      position: relative;
      margin-bottom: 20px;
    }
    .search-box input {
      width: 100%;
      padding: 12px 12px 12px 40px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-family: 'Montserrat', sans-serif;
      font-size: 14px;
    }
    .search-box svg {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: #999;
    }
    
    .form-card {
      background: #fff5f2;
      border: 2px solid #c35a3f;
      border-radius: 10px;
      padding: 25px;
      margin-bottom: 30px;
    }
    .form-card h3 {
      font-size: 20px;
      color: #333;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .form-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 20px;
    }
    .form-group label {
      display: block;
      font-size: 14px;
      font-weight: 600;
      color: #555;
      margin-bottom: 5px;
    }
    .form-group input,
    .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: 'Montserrat', sans-serif;
      font-size: 14px;
    }
    .form-actions {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }
    
    table {
      width: 100%;
      border-collapse: collapse;
    }
    thead {
      background: #f8f8f8;
      border-bottom: 2px solid #e0e0e0;
    }
    th {
      padding: 12px;
      text-align: left;
      font-size: 12px;
      font-weight: 600;
      color: #666;
      text-transform: uppercase;
    }
    td {
      padding: 15px 12px;
      border-bottom: 1px solid #f0f0f0;
    }
    tbody tr:hover {
      background: #f9f9f9;
    }
    
    .actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
    }
    .icon-btn {
      background: none;
      border: none;
      cursor: pointer;
      padding: 5px;
      transition: all 0.2s;
    }
    .icon-btn:hover { transform: scale(1.1); }
    .icon-btn.edit { color: #c35a3f; }
    .icon-btn.delete { color: #dc2626; }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #999;
    }
    .empty-state .icon { font-size: 60px; margin-bottom: 15px; }
    .empty-state h3 { font-size: 20px; color: #666; margin-bottom: 10px; }
    
    .stock-badge {
      display: inline-block;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
    }
    .stock-low { background: #fee; color: #c00; }
    .stock-ok { background: #efe; color: #060; }
    
    .summary {
      margin-top: 20px;
      padding: 15px;
      background: #f8f8f8;
      border-radius: 8px;
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      color: #666;
    }
    .summary strong { color: #333; }
    
    .close-btn {
      background: none;
      border: none;
      font-size: 24px;
      cursor: pointer;
      color: #999;
      padding: 0;
      line-height: 1;
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <div class="logo-circle">LC</div>
      <div class="header-title">
        <h1>La Caleta 102</h1>
        <p>Dashboard de Costes - Ingredientes</p>
      </div>
    </div>

    <!-- Main Card -->
    <div class="main-card">
      <div class="top-bar">
        <div>
          <h2>Ingredientes</h2>
          <p>Gestiona todos los ingredientes de tu restaurante</p>
        </div>
        <button class="btn btn-primary" onclick="mostrarFormulario()">
          <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
            <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          A√±adir Ingrediente
        </button>
      </div>

      <!-- Barra b√∫squeda -->
      <div class="search-box">
        <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
          <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
        </svg>
        <input type="text" id="busqueda" placeholder="Buscar ingredientes o proveedores..." oninput="filtrarIngredientes()">
      </div>

      <!-- Formulario -->
      <div id="formulario" class="form-card" style="display: none;">
        <h3>
          <span id="form-title">Nuevo Ingrediente</span>
          <button class="close-btn" onclick="cerrarFormulario()">√ó</button>
        </h3>
        <form onsubmit="guardarIngrediente(event)">
          <div class="form-grid">
            <div class="form-group">
              <label>Nombre del ingrediente *</label>
              <input type="text" id="nombre" required placeholder="Ej: Tomate">
            </div>
            <div class="form-group">
              <label>Proveedor</label>
              <input type="text" id="proveedor" placeholder="Ej: Mercabarna">
            </div>
            <div class="form-group">
              <label>Precio (‚Ç¨)</label>
              <input type="number" id="precio" step="0.01" min="0" placeholder="0.00">
            </div>
            <div class="form-group">
              <label>Unidad de medida</label>
              <select id="unidad">
                <option value="kg">Kilogramos (kg)</option>
                <option value="g">Gramos (g)</option>
                <option value="l">Litros (L)</option>
                <option value="ml">Mililitros (ml)</option>
                <option value="unidad">Unidades</option>
              </select>
            </div>
            <div class="form-group">
              <label>Stock actual</label>
              <input type="number" id="stockActual" step="0.01" min="0" placeholder="0">
            </div>
            <div class="form-group">
              <label>Stock m√≠nimo</label>
              <input type="number" id="stockMinimo" step="0.01" min="0" placeholder="0">
            </div>
          </div>
          <div class="form-actions">
            <button type="button" class="btn btn-secondary" onclick="cerrarFormulario()">Cancelar</button>
            <button type="submit" class="btn btn-primary">
              <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
              </svg>
              <span id="btn-text">A√±adir Ingrediente</span>
            </button>
          </div>
        </form>
      </div>

      <!-- Tabla -->
      <div id="tabla-container">
        <!-- Se llena con JavaScript -->
      </div>

      <!-- Resumen -->
      <div id="resumen" class="summary" style="display: none;">
        <div>Total de ingredientes: <strong id="total">0</strong></div>
        <div>Mostrando: <strong id="mostrando">0</strong></div>
      </div>
    </div>
  </div>

  <script>
    // Base de datos en memoria
    let ingredientes = [];
    let editandoIndex = null;

    // Cargar datos al iniciar
    function cargarDatos() {
      const datos = localStorage.getItem('lacaleta_ingredientes');
      if (datos) {
        ingredientes = JSON.parse(datos);
        renderizarTabla();
      }
    }

    // Guardar datos
    function guardarDatos() {
      localStorage.setItem('lacaleta_ingredientes', JSON.stringify(ingredientes));
    }

    // Mostrar formulario
    function mostrarFormulario() {
      document.getElementById('formulario').style.display = 'block';
      document.getElementById('nombre').focus();
    }

    // Cerrar formulario
    function cerrarFormulario() {
      document.getElementById('formulario').style.display = 'none';
      document.querySelector('form').reset();
      editandoIndex = null;
      document.getElementById('form-title').textContent = 'Nuevo Ingrediente';
      document.getElementById('btn-text').textContent = 'A√±adir Ingrediente';
    }

    // Guardar ingrediente
    function guardarIngrediente(event) {
      event.preventDefault();
      
      const ingrediente = {
        nombre: document.getElementById('nombre').value,
        proveedor: document.getElementById('proveedor').value,
        precio: document.getElementById('precio').value,
        unidad: document.getElementById('unidad').value,
        stockActual: document.getElementById('stockActual').value,
        stockMinimo: document.getElementById('stockMinimo').value,
        id: editandoIndex !== null ? ingredientes[editandoIndex].id : Date.now()
      };

      if (editandoIndex !== null) {
        ingredientes[editandoIndex] = ingrediente;
      } else {
        ingredientes.push(ingrediente);
      }

      guardarDatos();
      renderizarTabla();
      cerrarFormulario();
    }

    // Editar ingrediente
    function editarIngrediente(index) {
      const ing = ingredientes[index];
      document.getElementById('nombre').value = ing.nombre;
      document.getElementById('proveedor').value = ing.proveedor || '';
      document.getElementById('precio').value = ing.precio || '';
      document.getElementById('unidad').value = ing.unidad;
      document.getElementById('stockActual').value = ing.stockActual || '';
      document.getElementById('stockMinimo').value = ing.stockMinimo || '';
      
      editandoIndex = index;
      document.getElementById('form-title').textContent = 'Editar Ingrediente';
      document.getElementById('btn-text').textContent = 'Guardar Cambios';
      mostrarFormulario();
    }

    // Eliminar ingrediente
    function eliminarIngrediente(index) {
      if (confirm('¬øEst√°s seguro de eliminar este ingrediente?')) {
        ingredientes.splice(index, 1);
        guardarDatos();
        renderizarTabla();
      }
    }

    // Filtrar ingredientes
    function filtrarIngredientes() {
      renderizarTabla();
    }

    // Renderizar tabla
    function renderizarTabla() {
      const busqueda = document.getElementById('busqueda').value.toLowerCase();
      const filtrados = ingredientes.filter(ing => 
        ing.nombre.toLowerCase().includes(busqueda) ||
        (ing.proveedor && ing.proveedor.toLowerCase().includes(busqueda))
      );

      const container = document.getElementById('tabla-container');
      
      if (filtrados.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="icon">üì¶</div>
            <h3>${busqueda ? 'No se encontraron ingredientes' : 'A√∫n no hay ingredientes'}</h3>
            <p>${busqueda ? 'Intenta con otra b√∫squeda' : 'A√±ade tu primer ingrediente para comenzar'}</p>
          </div>
        `;
        document.getElementById('resumen').style.display = 'none';
      } else {
        let html = '<table><thead><tr>';
        html += '<th>Ingrediente</th>';
        html += '<th>Proveedor</th>';
        html += '<th>Precio</th>';
        html += '<th>Stock</th>';
        html += '<th style="text-align: right;">Acciones</th>';
        html += '</tr></thead><tbody>';

        filtrados.forEach((ing, idx) => {
          const realIndex = ingredientes.indexOf(ing);
          const stockBajo = parseFloat(ing.stockActual || 0) <= parseFloat(ing.stockMinimo || 0);
          
          html += '<tr>';
          html += `<td><strong>${ing.nombre}</strong></td>`;
          html += `<td>${ing.proveedor || '-'}</td>`;
          html += `<td>${ing.precio ? parseFloat(ing.precio).toFixed(2) + ' ‚Ç¨/' + ing.unidad : '-'}</td>`;
          html += `<td>`;
          if (ing.stockActual) {
            html += `<span class="stock-badge ${stockBajo ? 'stock-low' : 'stock-ok'}">${ing.stockActual} ${ing.unidad}</span>`;
            if (stockBajo && ing.stockMinimo) html += ` ‚ö†Ô∏è Stock bajo`;
          } else {
            html += '-';
          }
          html += `</td>`;
          html += `<td><div class="actions">`;
          html += `<button class="icon-btn edit" onclick="editarIngrediente(${realIndex})">`;
          html += '<svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/></svg>';
          html += '</button>';
          html += `<button class="icon-btn delete" onclick="eliminarIngrediente(${realIndex})">`;
          html += '<svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>';
          html += '</button>';
          html += '</div></td>';
          html += '</tr>';
        });

        html += '</tbody></table>';
        container.innerHTML = html;

        document.getElementById('total').textContent = ingredientes.length;
        document.getElementById('mostrando').textContent = filtrados.length;
        document.getElementById('resumen').style.display = 'flex';
      }
    }

    // Iniciar app
    cargarDatos();
  </script>
</body>
</html>
