<!DOCTYPE html>
<html lang="es">

<head>
  <!-- Sentry Error Monitoring SDK (init en src/utils/sentry.js) -->
  <script src="https://browser.sentry-cdn.com/7.99.0/bundle.min.js" crossorigin="anonymous"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">

  <!-- SEO Meta Tags -->
  <title>MindLoopIA CostOS - Restaurant Intelligence Platform</title>
  <meta name="description"
    content="Plataforma de inteligencia para restaurantes. Gestiona costes, recetas, inventario y an√°lisis financiero de tu negocio gastron√≥mico.">
  <meta name="keywords" content="restaurante, gesti√≥n, costes, recetas, inventario, food cost, hosteler√≠a, MindLoop">
  <meta name="author" content="MindLoop IA">
  <meta name="robots" content="index, follow">

  <!-- Open Graph / Social Media -->
  <meta property="og:type" content="website">
  <meta property="og:title" content="MindLoop CostOS - Restaurant Intelligence">
  <meta property="og:description"
    content="Plataforma de inteligencia para restaurantes. Gesti√≥n de costes, recetas e inventario.">
  <meta property="og:url" content="https://klaker79.github.io/lacaletacost/">

  <!-- PWA / Mobile -->
  <meta name="theme-color" content="#667eea">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="MindLoop CostOS">
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/images/logo-sin-circulo.png">

  <!-- Favicon -->
  <link rel="icon" href="https://em-content.zobj.net/source/apple/391/pot-of-food_1f372.png" type="image/png">
  <link rel="apple-touch-icon" href="https://em-content.zobj.net/source/apple/391/pot-of-food_1f372.png">

  <!-- Preconnect para performance -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet" media="print" onload="this.media='all'">
  <noscript>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet">
  </noscript>

  <!-- Scripts externos: Migrados a npm (ver src/vendors.js) -->
  <!-- Chart.js, XLSX, jsPDF ahora se cargan desde node_modules -->
  <!-- Esto mejora seguridad y control de versiones -->

  <link rel="stylesheet" href="styles/main.css?v=20260120-sidebar">
  <link rel="stylesheet" href="styles/polish.css?v=20260216">

  <!-- üì± Service Worker para PWA -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then(reg => console.log('‚úÖ Service Worker registrado:', reg.scope))
          .catch(err => console.warn('‚ùå Service Worker error:', err));
      });
    }
  </script>
</head>

<body>
  <!-- Pantalla de Login -->
  <div id="login-screen" class="login-screen">
    <div class="login-container">
      <div class="login-header">
        <h1>üçΩÔ∏è MindLoopIA CostOS</h1>
        <p>Restaurant Intelligence Platform</p>
      </div>
      <form id="login-form" class="login-form">
        <div class="form-group">
          <label for="login-email" data-i18n="auth:email_label">Email</label>
          <input type="email" id="login-email" placeholder="tu@email.com" data-i18n-placeholder="auth:email_placeholder" required>
        </div>
        <div class="form-group">
          <label for="login-password" data-i18n="auth:password_label">Contrase√±a</label>
          <input type="password" id="login-password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
        </div>
        <button type="submit" class="login-btn" data-i18n="auth:btn_login">Iniciar Sesi√≥n</button>
        <p id="login-error" class="login-error"></p>
      </form>
      <div class="login-footer">
        <p data-i18n="auth:link_register">¬øNo tienes cuenta? <a href="#" data-action="mostrar-registro" data-i18n="auth:link_register_action">Registrar restaurante</a></p>
      </div>

      <!-- Formulario de Registro -->
      <form id="register-form" class="login-form" style="display: none;">
        <div class="form-group">
          <label for="reg-nombre" data-i18n="auth:restaurant_name_label">Nombre del restaurante</label>
          <input type="text" id="reg-nombre" placeholder="Mi Restaurante" data-i18n-placeholder="common:sidebar_my_restaurant" required>
        </div>
        <div class="form-group">
          <label for="reg-email" data-i18n="auth:email_label">Email</label>
          <input type="email" id="reg-email" placeholder="tu@email.com" data-i18n-placeholder="auth:email_placeholder" required>
        </div>
        <div class="form-group">
          <label for="reg-password" data-i18n="auth:password_label">Contrase√±a</label>
          <input type="password" id="reg-password" placeholder="M√≠nimo 6 caracteres" data-i18n-placeholder="auth:password_placeholder" minlength="6" required>
        </div>
        <div class="form-group">
          <label for="reg-password2" data-i18n="auth:password_confirm_label">Confirmar contrase√±a</label>
          <input type="password" id="reg-password2" placeholder="Repite la contrase√±a" data-i18n-placeholder="auth:password_confirm_placeholder" minlength="6" required>
        </div>
        <button type="submit" class="login-btn" data-i18n="auth:btn_register">Crear Restaurante</button>
        <p id="register-error" class="login-error"></p>
        <p style="text-align: center; margin-top: 12px;">
          <a href="#" data-action="mostrar-login" data-i18n="auth:link_back_to_login">‚Üê Volver al login</a>
        </p>
      </form>
    </div>
  </div>
  <!-- üè™ Pantalla de Selecci√≥n de Restaurante (multi-restaurant) -->
  <div id="restaurant-selector-screen" class="login-screen" style="display: none;">
    <div class="login-container">
      <div class="login-header">
        <h1>MindLoopIA CostOS</h1>
        <p data-i18n="auth:select_restaurant_title">Selecciona un restaurante</p>
      </div>
      <div id="restaurant-list" style="display: flex; flex-direction: column; gap: 12px; padding: 20px 0;">
        <!-- Populated dynamically by auth.js -->
      </div>
    </div>
  </div>

  <!-- üì± App Container con Sidebar -->
  <div class="app" id="app-container" style="display: none;">

    <!-- Bot√≥n m√≥vil para abrir sidebar -->
    <button class="mobile-menu-toggle" id="mobile-menu-toggle"
      onclick="document.getElementById('sidebar').classList.toggle('open')">‚ò∞</button>

    <!-- Sidebar Navigation -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <a href="#" class="sidebar-brand">
          <div class="sidebar-brand-icon">üçΩÔ∏è</div>
          <div class="sidebar-brand-text">
            <span class="sidebar-brand-name">CostOS</span>
            <span class="sidebar-brand-tagline">Restaurant Intelligence</span>
          </div>
        </a>
      </div>

      <nav class="sidebar-nav">
        <!-- Ingredientes -->
        <div class="nav-section">
          <div class="nav-section-title" data-i18n="common:nav_ingredientes">Ingredientes</div>
          <button class="nav-item active" data-tab="ingredientes">
            <span class="nav-item-icon">üì¶</span>
            <span class="nav-item-text" data-i18n="common:nav_ingredientes">Ingredientes</span>
          </button>
          <button class="nav-item" data-tab="recetas">
            <span class="nav-item-icon">üë®‚Äçüç≥</span>
            <span class="nav-item-text" data-i18n="common:nav_recetas">Recetas</span>
          </button>
          <button class="nav-item" data-tab="proveedores">
            <span class="nav-item-icon">üöö</span>
            <span class="nav-item-text" data-i18n="common:nav_proveedores">Proveedores</span>
          </button>
        </div>

        <!-- Operaciones -->
        <div class="nav-section">
          <div class="nav-section-title" data-i18n="common:nav_section_operations">Operaciones</div>
          <button class="nav-item" data-tab="pedidos">
            <span class="nav-item-icon">üìã</span>
            <span class="nav-item-text" data-i18n="common:nav_pedidos">Pedidos</span>
          </button>
          <button class="nav-item" data-tab="ventas">
            <span class="nav-item-icon">üí∞</span>
            <span class="nav-item-text" data-i18n="common:nav_ventas">Ventas</span>
          </button>
          <button class="nav-item" data-tab="inventario">
            <span class="nav-item-icon">üì¶</span>
            <span class="nav-item-text" data-i18n="common:nav_inventario">Inventario</span>
            <span class="nav-item-badge" id="badge-inventario-sidebar" style="display:none;">0</span>
          </button>
        </div>

        <!-- An√°lisis -->
        <div class="nav-section">
          <div class="nav-section-title" data-i18n="common:nav_section_analysis">An√°lisis</div>
          <button class="nav-item" data-tab="diario">
            <span class="nav-item-icon">üìà</span>
            <span class="nav-item-text" data-i18n="common:nav_dashboard">Diario</span>
          </button>
          <button class="nav-item" data-tab="analisis">
            <span class="nav-item-icon">üìä</span>
            <span class="nav-item-text" data-i18n="common:nav_analisis">An√°lisis</span>
          </button>
          <button class="nav-item" data-tab="inteligencia">
            <span class="nav-item-icon">üß†</span>
            <span class="nav-item-text" data-i18n="common:nav_inteligencia">Inteligencia</span>
            <span class="nav-item-badge intel">IA</span>
          </button>
        </div>

        <!-- Configuraci√≥n -->
        <div class="nav-section">
          <div class="nav-section-title" data-i18n="common:nav_section_config">Configuraci√≥n</div>
          <button class="nav-item" data-tab="horarios">
            <span class="nav-item-icon">üë•</span>
            <span class="nav-item-text" data-i18n="common:nav_horarios">Horarios</span>
          </button>
          <button class="nav-item" data-tab="configuracion">
            <span class="nav-item-icon">‚öôÔ∏è</span>
            <span class="nav-item-text" data-i18n="common:nav_configuracion">Configuraci√≥n</span>
          </button>
        </div>
      </nav>

      <!-- Language Switcher -->
      <div id="language-switcher" style="padding: 8px 12px; display: flex; gap: 4px; justify-content: center;">
        <button class="lang-btn" data-lang="es" onclick="window.changeLanguage('es')"
          style="flex: 1; padding: 6px 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.15); background: rgba(255,255,255,0.1); color: #e2e8f0; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px;">
          <img src="https://flagcdn.com/w40/es.png" width="20" height="14" alt="ES" style="border-radius: 2px; object-fit: cover;"> ES
        </button>
        <button class="lang-btn" data-lang="en" onclick="window.changeLanguage('en')"
          style="flex: 1; padding: 6px 10px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.15); background: transparent; color: rgba(255,255,255,0.5); font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; justify-content: center; gap: 6px;">
          <img src="https://flagcdn.com/w40/gb.png" width="20" height="14" alt="EN" style="border-radius: 2px; object-fit: cover;"> EN
        </button>
      </div>

      <div class="sidebar-footer" style="position: relative;">
        <div class="sidebar-user" id="sidebar-restaurant-switcher" style="cursor: pointer;">
          <div class="avatar" id="sidebar-avatar">--</div>
          <div class="sidebar-user-info">
            <div class="sidebar-user-name" id="sidebar-restaurant-name" data-i18n="common:sidebar_my_restaurant">Mi Restaurante</div>
            <div class="sidebar-user-role" style="font-size: 11px; opacity: 0.6;" data-i18n="common:sidebar_switch">Cambiar ‚ñæ</div>
          </div>
        </div>
        <div id="restaurant-switcher-dropdown" style="display: none; position: absolute; bottom: 70px; left: 8px; right: 8px;
             background: var(--bg-secondary, #1e293b); border: 1px solid rgba(255,255,255,0.15); border-radius: 12px;
             padding: 8px; z-index: 1000; box-shadow: 0 10px 30px rgba(0,0,0,0.3);">
        </div>
      </div>

      <button class="sidebar-toggle" id="sidebar-toggle" title="Colapsar men√∫" data-i18n-title="common:sidebar_collapse"
        onclick="document.querySelector('.app').classList.toggle('sidebar-collapsed')">‚óÄ</button>
    </aside>

    <!-- Main Content -->
    <div class="app-content">
      <div class="main-content">
        <div class="header" style="justify-content: space-between; padding: 20px 30px;">
          <div style="display: flex; align-items: center; flex: 1; gap: 20px;">
            <div>
              <h1
                style="margin: 0; font-size: 2rem; font-weight: 800; letter-spacing: -0.5px; background: linear-gradient(135deg, #ff8c42 0%, #ffb347 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">
                MindLoopIA CostOS</h1>
              <p
                style="margin: 4px 0 0 0; font-size: 0.95rem; color: rgba(255,255,255,0.85); font-weight: 500; letter-spacing: 0.5px;">
                Restaurant Intelligence Platform</p>
            </div>
          </div>
          <div style="display: flex; align-items: center; gap: 20px;">
            <span id="user-restaurant" style="color: rgba(255,255,255,0.9); font-size: 14px; font-weight: 500;"></span>
            <button id="theme-toggle" data-action="toggle-theme" title="Cambiar tema" data-i18n-title="common:theme_toggle"
              style="background: rgba(255,255,255,0.15); color: white; border: none; padding: 10px 12px; border-radius: 10px; cursor: pointer; font-size: 18px; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center;"
              onmouseover="this.style.background='rgba(255,255,255,0.25)'; this.style.transform='translateY(-2px)';"
              onmouseout="this.style.background='rgba(255,255,255,0.15)'; this.style.transform='translateY(0)';">
              <span class="theme-icon">üåô</span>
            </button>
            <button data-action="logout" data-i18n="common:sidebar_logout"
              style="background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer; font-size: 14px; font-weight: 600; box-shadow: 0 4px 15px rgba(239,68,68,0.4); transition: all 0.3s ease;"
              onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(239,68,68,0.5)';"
              onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(239,68,68,0.4)';">Cerrar
              Sesi√≥n</button>
          </div>
        </div>

        <!-- üóìÔ∏è Banner de Fecha Actual -->
        <div id="fecha-actual-banner" style="
      margin: 0 32px 16px 32px;
      padding: 12px 20px;
      background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
      border-radius: 12px;
      border-left: 4px solid #0ea5e9;
      display: flex;
      justify-content: space-between;
      align-items: center;
    ">
          <div style="display: flex; align-items: center; gap: 12px;">
            <span style="font-size: 24px;">üìÖ</span>
            <div>
              <div id="fecha-hoy-texto" style="font-size: 16px; font-weight: 600; color: #0c4a6e;">
                Cargando fecha...
              </div>
              <div id="periodo-info" style="font-size: 12px; color: #0369a1; margin-top: 2px;">
                Semana X ¬∑ Mes de XXXX
              </div>
            </div>
          </div>
          <div style="display: flex; gap: 8px;">
            <button onclick="window.cambiarPeriodoVista('hoy')" class="periodo-btn" data-periodo="hoy" style="
          padding: 6px 12px;
          border-radius: 6px;
          border: 1px solid #0ea5e9;
          background: white;
          color: #0369a1;
          font-size: 12px;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.2s;
        " data-i18n="dashboard:period_today">Hoy</button>
            <button onclick="window.cambiarPeriodoVista('semana')" class="periodo-btn active" data-periodo="semana"
              style="
          padding: 6px 12px;
          border-radius: 6px;
          border: 1px solid #0ea5e9;
          background: #0ea5e9;
          color: white;
          font-size: 12px;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.2s;
        " data-i18n="dashboard:period_week">Semana</button>
            <button onclick="window.cambiarPeriodoVista('mes')" class="periodo-btn" data-periodo="mes" style="
          padding: 6px 12px;
          border-radius: 6px;
          border: 1px solid #0ea5e9;
          background: white;
          color: #0369a1;
          font-size: 12px;
          font-weight: 500;
          cursor: pointer;
          transition: all 0.2s;
        " data-i18n="dashboard:period_month_short">Mes</button>
          </div>
        </div>

        <!-- KPI Dashboard Compacto con Sparklines -->
        <div style="display: flex; align-items: center; gap: 12px; margin: 0 32px 16px 32px; flex-wrap: wrap;">
          <!-- KPI Ingresos -->
          <div class="kpi-mini"
            style="flex: 1; min-width: 150px; background: white; border-radius: 12px; padding: 12px 16px; display: flex; align-items: center; gap: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border-left: 3px solid #10B981;">
            <span style="font-size: 24px;">üí∞</span>
            <div style="flex: 1;">
              <div style="font-size: 20px; font-weight: 700; color: #1E293B;" id="kpi-ingresos" data-animate="true">
                <span class="skeleton skeleton-number" data-skeleton>‚†Ä</span>
              </div>
              <div style="font-size: 11px; color: #64748B; text-transform: uppercase;" data-i18n="dashboard:kpi_revenue">Ingresos</div>
            </div>
            <div id="sparkline-ingresos" style="opacity: 0.8;"></div>
          </div>

          <!-- KPI Pedidos -->
          <div class="kpi-mini"
            style="flex: 1; min-width: 150px; background: white; border-radius: 12px; padding: 12px 16px; display: flex; align-items: center; gap: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border-left: 3px solid #3B82F6;">
            <span style="font-size: 24px;">üìã</span>
            <div style="flex: 1;">
              <div style="font-size: 20px; font-weight: 700; color: #1E293B;" id="kpi-pedidos" data-animate="true"><span
                  class="skeleton skeleton-number" data-skeleton>‚†Ä</span>
              </div>
              <div style="font-size: 11px; color: #64748B; text-transform: uppercase;" data-i18n="dashboard:kpi_orders">Pedidos</div>
            </div>
          </div>

          <!-- KPI Stock Bajo -->
          <div class="kpi-mini"
            style="flex: 1; min-width: 150px; background: white; border-radius: 12px; padding: 12px 16px; display: flex; align-items: center; gap: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border-left: 3px solid #F59E0B;">
            <span style="font-size: 24px;">‚ö†Ô∏è</span>
            <div style="flex: 1;">
              <div style="font-size: 20px; font-weight: 700; color: #1E293B;" id="kpi-stock" data-animate="true"><span
                  class="skeleton skeleton-number" data-skeleton>‚†Ä</span></div>
              <div style="font-size: 11px; color: #64748B; text-transform: uppercase;" data-i18n="dashboard:kpi_low_stock">Stock Bajo</div>
            </div>
          </div>

          <!-- KPI Margen -->
          <div class="kpi-mini"
            style="flex: 1; min-width: 150px; background: white; border-radius: 12px; padding: 12px 16px; display: flex; align-items: center; gap: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); border-left: 3px solid #8B5CF6;">
            <span style="font-size: 24px;">üìä</span>
            <div style="flex: 1;">
              <div style="font-size: 20px; font-weight: 700; color: #1E293B;" id="kpi-margen" data-animate="true"><span
                  class="skeleton skeleton-number" data-skeleton>‚†Ä</span>
              </div>
              <div style="font-size: 11px; color: #64748B; text-transform: uppercase;" data-i18n="dashboard:kpi_margin">Margen</div>
            </div>
            <div id="sparkline-margen" style="opacity: 0.8;"></div>
          </div>


        </div>
        <!-- üéØ DASHBOARD PREMIUM - Full Width Grid -->
        <div id="dashboard-premium" style="margin: 0 20px 20px 20px;">

          <!-- Fila 1: Grid 3 columnas iguales -->
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; margin-bottom: 16px;">

            <!-- üö® Stock Bajo -->
            <div class="dashboard-card"
              style="background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid #f1f5f9;">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                <div
                  style="width: 44px; height: 44px; background: linear-gradient(135deg, #FEF3C7, #FDE68A); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                  ‚ö†Ô∏è</div>
                <div>
                  <h3 style="margin: 0; font-size: 15px; font-weight: 700; color: #1E293B;" data-i18n="dashboard:kpi_low_stock">Stock Bajo</h3>
                  <p style="margin: 2px 0 0; font-size: 12px; color: #64748B;" data-i18n="dashboard:stock_needs_attention">Requieren atenci√≥n</p>
                </div>
                <div style="margin-left: auto; font-size: 24px; font-weight: 800; color: #F59E0B;" id="kpi-stock-count">
                  0
                </div>
              </div>
              <div id="alertas-stock-lista" style="max-height: 120px; overflow-y: auto; font-size: 13px;">
                <div data-skeleton>
                  <div class="skeleton-row">
                    <div class="skeleton skeleton-text"></div>
                    <div class="skeleton skeleton-number"></div>
                  </div>
                  <div class="skeleton-row">
                    <div class="skeleton skeleton-text" style="width:65%"></div>
                    <div class="skeleton skeleton-number"></div>
                  </div>
                  <div class="skeleton-row">
                    <div class="skeleton skeleton-text" style="width:75%"></div>
                    <div class="skeleton skeleton-number"></div>
                  </div>
                </div>
              </div>
            </div>

            <!-- üìä Resumen Hoy -->
            <div class="dashboard-card"
              style="background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid #f1f5f9;">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                <div
                  style="width: 44px; height: 44px; background: linear-gradient(135deg, #DBEAFE, #BFDBFE); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                  üìä</div>
                <div>
                  <h3 id="actividad-titulo" style="margin: 0; font-size: 15px; font-weight: 700; color: #1E293B;" data-i18n="dashboard:period_today">Hoy
                  </h3>
                  <p id="actividad-subtitulo" style="margin: 2px 0 0; font-size: 12px; color: #64748B;" data-i18n="dashboard:activity_today">Actividad del
                    d√≠a</p>
                </div>
              </div>
              <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px;">
                <div
                  style="text-align: center; padding: 14px 8px; background: linear-gradient(135deg, #F0FDF4, #DCFCE7); border-radius: 12px;">
                  <div style="font-size: 24px; font-weight: 800; color: #10B981;" id="ventas-hoy"><span
                      class="skeleton skeleton-number" data-skeleton style="margin:0 auto">‚†Ä</span></div>
                  <div style="font-size: 11px; color: #059669; font-weight: 600;" data-i18n="dashboard:sales_label">Ventas</div>
                </div>
                <div
                  style="text-align: center; padding: 14px 8px; background: linear-gradient(135deg, #EFF6FF, #DBEAFE); border-radius: 12px;">
                  <div style="font-size: 24px; font-weight: 800; color: #3B82F6;" id="ingresos-hoy"><span
                      class="skeleton skeleton-number" data-skeleton style="margin:0 auto">‚†Ä</span></div>
                  <div style="font-size: 11px; color: #2563EB; font-weight: 600;" data-i18n="dashboard:income_label">Ingresos</div>
                </div>
                <div
                  style="text-align: center; padding: 14px 8px; background: linear-gradient(135deg, #FFF7ED, #FFEDD5); border-radius: 12px;">
                  <div
                    style="font-size: 13px; font-weight: 700; color: #F59E0B; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"
                    id="plato-estrella-hoy"><span class="skeleton skeleton-number" data-skeleton
                      style="margin:0 auto;width:80px">‚†Ä</span></div>
                  <div style="font-size: 11px; color: #D97706; font-weight: 600;" data-i18n="dashboard:kpi_star_dish">‚≠ê Estrella</div>
                </div>
              </div>
            </div>

            <!-- üë• Personal Hoy (Empleados que libran) -->
            <div class="dashboard-card"
              style="background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid #f1f5f9;">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                <div
                  style="width: 44px; height: 44px; background: linear-gradient(135deg, #E0E7FF, #C7D2FE); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                  üë•</div>
                <div>
                  <h3 style="margin: 0; font-size: 15px; font-weight: 700; color: #1E293B;" data-i18n="dashboard:staff_today">Personal Hoy</h3>
                  <p style="margin: 2px 0 0; font-size: 12px; color: #64748B;" data-i18n="dashboard:staff_who_works">Qui√©n trabaja / libra</p>
                </div>
              </div>
              <div id="personal-hoy-lista" style="max-height: 100px; overflow-y: auto; font-size: 13px;">
                <div data-skeleton>
                  <div class="skeleton-row">
                    <div class="skeleton skeleton-text" style="width:50%"></div>
                    <div class="skeleton skeleton-text-sm" style="width:30%"></div>
                  </div>
                  <div class="skeleton-row">
                    <div class="skeleton skeleton-text" style="width:60%"></div>
                    <div class="skeleton skeleton-text-sm" style="width:25%"></div>
                  </div>
                  <div class="skeleton-row">
                    <div class="skeleton skeleton-text" style="width:45%"></div>
                    <div class="skeleton skeleton-text-sm" style="width:35%"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Fila 2: Grid 3 columnas -->
          <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px;">

            <!-- üí∞ Valor Stock Total -->
            <div class="dashboard-card"
              style="background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid #f1f5f9;">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                <div
                  style="width: 44px; height: 44px; background: linear-gradient(135deg, #D1FAE5, #A7F3D0); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                  üí∞</div>
                <div style="flex: 1;">
                  <h3 style="margin: 0; font-size: 15px; font-weight: 700; color: #1E293B;" data-i18n="dashboard:stock_value_title">Valor Stock</h3>
                  <p style="margin: 2px 0 0; font-size: 12px; color: #64748B;" data-i18n="dashboard:stock_value_subtitle">Inventario valorizado</p>
                </div>
                <div style="text-align: right;">
                  <div id="kpi-items-stock" style="font-size: 18px; font-weight: 700; color: #3B82F6;">-</div>
                  <div style="font-size: 10px; color: #64748B;" data-i18n="dashboard:kpi_items">Items</div>
                </div>
              </div>
              <div id="kpi-valor-stock" style="font-size: 32px; font-weight: 800; color: #10B981; margin-bottom: 16px;">
                -‚Ç¨
              </div>
              <div style="display: flex; gap: 8px;">
                <button data-tab="ventas"
                  style="flex: 1; padding: 10px; background: linear-gradient(135deg, #10B981, #059669); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 12px; transition: transform 0.2s;"
                  onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'" data-i18n="dashboard:quick_sale">üí∞
                  Venta</button>
                <button data-tab="pedidos"
                  style="flex: 1; padding: 10px; background: linear-gradient(135deg, #3B82F6, #2563EB); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 12px; transition: transform 0.2s;"
                  onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'" data-i18n="dashboard:quick_order">üì¶
                  Pedido</button>
                <button data-tab="inventario"
                  style="flex: 1; padding: 10px; background: linear-gradient(135deg, #F59E0B, #D97706); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 12px; transition: transform 0.2s;"
                  onmouseover="this.style.transform='scale(1.02)'" onmouseout="this.style.transform='scale(1)'" data-i18n="dashboard:quick_stock">üîç
                  Stock</button>
              </div>
            </div>

            <!-- üìà Proyecci√≥n -->
            <div class="dashboard-card"
              style="background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid #f1f5f9;">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 12px;">
                <div
                  style="width: 44px; height: 44px; background: linear-gradient(135deg, #EDE9FE, #DDD6FE); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                  üìà</div>
                <div style="flex: 1;">
                  <h3 style="margin: 0; font-size: 15px; font-weight: 700; color: #1E293B;" data-i18n="dashboard:forecast_title">Proyecci√≥n</h3>
                  <p style="margin: 2px 0 0; font-size: 12px; color: #64748B;" data-i18n="dashboard:forecast_subtitle">Estimaci√≥n de ingresos</p>
                </div>
                <span id="forecast-total" style="font-size: 22px; font-weight: 800; color: #8B5CF6;">0‚Ç¨</span>
              </div>
              <div id="forecast-tabs" style="display: flex; gap: 6px; margin-bottom: 12px;">
                <button class="forecast-period-tab active" data-period="7"
                  style="flex: 1; padding: 8px 0; border: none; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 600; background: linear-gradient(135deg, #8B5CF6, #7C3AED); color: white; transition: all 0.2s;" data-i18n="dashboard:forecast_7days">7
                  d√≠as</button>
                <button class="forecast-period-tab" data-period="30"
                  style="flex: 1; padding: 8px 0; border: none; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 500; background: #f1f5f9; color: #64748b; transition: all 0.2s;" data-i18n="dashboard:period_month_short">Mes</button>
              </div>
              <div style="height: 80px; position: relative;">
                <canvas id="chart-forecast"></canvas>
              </div>
              <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 8px;">
                <div id="forecast-comparativa"
                  style="font-size: 11px; font-weight: 600; padding: 4px 10px; border-radius: 6px; background: #f1f5f9;">
                </div>
                <div id="forecast-confianza" style="font-size: 10px; color: #94a3b8;" data-i18n="dashboard:forecast_default">Basado en historial</div>
              </div>
            </div>

            <!-- üìä Cambios de Precio -->
            <div class="dashboard-card"
              style="background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid #f1f5f9;">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                <div
                  style="width: 44px; height: 44px; background: linear-gradient(135deg, #FEE2E2, #FECACA); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                  üìä</div>
                <div>
                  <h3 style="margin: 0; font-size: 15px; font-weight: 700; color: #1E293B;" data-i18n="dashboard:price_changes_title">Variaci√≥n Costes</h3>
                  <p style="margin: 2px 0 0; font-size: 12px; color: #64748B;" data-i18n="dashboard:price_changes_subtitle">√öltimas variaciones</p>
                </div>
              </div>
              <div id="lista-cambios-precio" style="max-height: 120px; overflow-y: auto; font-size: 13px;">
                <div data-skeleton>
                  <div class="skeleton-row">
                    <div class="skeleton skeleton-text"></div>
                    <div class="skeleton skeleton-number"></div>
                  </div>
                  <div class="skeleton-row">
                    <div class="skeleton skeleton-text" style="width:70%"></div>
                    <div class="skeleton skeleton-number"></div>
                  </div>
                  <div class="skeleton-row">
                    <div class="skeleton skeleton-text" style="width:85%"></div>
                    <div class="skeleton skeleton-number"></div>
                  </div>
                </div>
              </div>
            </div>

          </div>

          <!-- Fila 3: Top Proveedores (full width) -->
          <div style="margin-top: 16px;">
            <div class="dashboard-card"
              style="background: white; border-radius: 16px; padding: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); border: 1px solid #f1f5f9;">
              <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                <div
                  style="width: 44px; height: 44px; background: linear-gradient(135deg, #E0E7FF, #C7D2FE); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 20px;">
                  üì¶</div>
                <div style="flex: 1;">
                  <h3 style="margin: 0; font-size: 15px; font-weight: 700; color: #1E293B;" data-i18n="dashboard:top_suppliers_title">Top Proveedores</h3>
                  <p style="margin: 2px 0 0; font-size: 12px; color: #64748B;" data-i18n="dashboard:top_suppliers_subtitle">Gasto este mes</p>
                </div>
                <div id="dashboard-proveedores-total" style="font-size: 22px; font-weight: 800; color: #6366F1;">0‚Ç¨
                </div>
              </div>
              <div id="dashboard-proveedores-barras"
                style="display: flex; flex-direction: column; gap: 10px; max-height: 200px; overflow-y: auto;">
                <div data-skeleton>
                  <div class="skeleton-prov-bar">
                    <div class="skeleton skeleton-text"></div>
                    <div class="skeleton skeleton-bar"></div>
                    <div class="skeleton skeleton-number"></div>
                  </div>
                  <div class="skeleton-prov-bar">
                    <div class="skeleton skeleton-text"></div>
                    <div class="skeleton skeleton-bar" style="width:75%"></div>
                    <div class="skeleton skeleton-number"></div>
                  </div>
                  <div class="skeleton-prov-bar">
                    <div class="skeleton skeleton-text"></div>
                    <div class="skeleton skeleton-bar" style="width:55%"></div>
                    <div class="skeleton skeleton-number"></div>
                  </div>
                  <div class="skeleton-prov-bar">
                    <div class="skeleton skeleton-text"></div>
                    <div class="skeleton skeleton-bar" style="width:40%"></div>
                    <div class="skeleton skeleton-number"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>


      </div>
      <div class="tabs">
        <button id="tab-btn-ingredientes" class="tab active" data-tab="ingredientes" data-i18n="common:tab_ingredientes">üì¶
          Ingredientes</button>
        <button id="tab-btn-recetas" class="tab" data-tab="recetas" data-i18n="common:tab_recetas">üë®‚Äçüç≥ Recetas</button>
        <button id="tab-btn-proveedores" class="tab" data-tab="proveedores" data-i18n="common:tab_proveedores">üöö Proveedores</button>
        <button id="tab-btn-pedidos" class="tab" data-tab="pedidos" data-i18n="common:tab_pedidos">üìã Pedidos</button>
        <button id="tab-btn-ventas" class="tab" data-tab="ventas" data-i18n="common:tab_ventas">üí∞ Ventas</button>
        <button id="tab-btn-inventario" class="tab" data-tab="inventario" data-i18n-html="common:tab_inventario">üì¶ Inventario<span id="badge-inventario"
            class="tab-badge" style="display:none;">0</span></button>
        <button id="tab-btn-diario" class="tab" data-tab="diario" data-i18n="common:tab_diario">üìà Diario</button>
        <button id="tab-btn-analisis" class="tab" data-tab="analisis" data-i18n="common:tab_analisis">üìä An√°lisis</button>
        <button id="tab-btn-inteligencia" class="tab" data-tab="inteligencia"
          style="background: linear-gradient(135deg, #6366f1, #8b5cf6); color: white; border: none;" data-i18n="common:tab_inteligencia">üß†
          Inteligencia</button>
        <button id="tab-btn-horarios" class="tab" data-tab="horarios" data-i18n="common:tab_horarios">üë• Horarios</button>
        <button id="tab-btn-configuracion" class="tab" data-tab="configuracion" data-i18n="common:tab_configuracion">‚öôÔ∏è
          Configuraci√≥n</button>
      </div>

      <div class="main-card">



        <!-- TAB: INGREDIENTES (c√≥digo anterior simplificado por brevedad) -->
        <div id="tab-ingredientes" class="tab-content active">
          <div class="top-bar">
            <div>
              <h2 data-i18n="ingredientes:title">Ingredientes</h2>
              <p data-i18n="ingredientes:description">Gestiona todos los ingredientes de tu restaurante</p>
            </div>
            <div style="display: flex; gap: 10px;">
              <button class="btn btn-primary" data-action="mostrar-form-ingrediente" data-i18n="ingredientes:btn_new">‚ûï A√±adir Ingrediente</button>
              <button class="btn btn-secondary" data-action="importar-ingredientes" data-i18n="common:btn_import_excel">üì§ Importar
                Excel</button>
              <button class="btn btn-secondary" data-action="exportar-ingredientes" data-i18n="common:btn_export_excel">üì• Exportar Excel</button>
            </div>
          </div>
          <div class="search-box">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <circle cx="11" cy="11" r="8" />
              <path d="m21 21-4.35-4.35" />
            </svg>
            <input type="search" id="busqueda-ingredientes" name="busqueda_ing_nocache" placeholder="Buscar..." data-i18n-placeholder="common:search_placeholder"
              autocomplete="off" oninput="window.renderizarIngredientes()">
          </div>
          <div id="formulario-ingrediente" class="form-card" style="display: none;">
            <h3>
              <span id="form-title-ingrediente" data-i18n="ingredientes:form_title_new">Nuevo Ingrediente</span>
              <button class="close-btn" data-action="cerrar-form-ingrediente">√ó</button>
            </h3>
            <form onsubmit="window.guardarIngrediente(event)">
              <div class="form-grid">
                <div class="form-group">
                  <label data-i18n="common:label_name_required">Nombre *</label>
                  <input type="text" id="ing-nombre" required>
                </div>
                <div class="form-group">
                  <label data-i18n="common:label_supplier">Proveedor</label>
                  <select id="ing-proveedor-select">
                    <option value="" data-i18n="ingredientes:no_supplier">Sin proveedor</option>
                  </select>
                </div>
                <div class="form-group">
                  <label data-i18n="common:label_price">Precio (‚Ç¨)</label>
                  <input type="number" id="ing-precio" step="0.01" min="0">
                </div>
                <div class="form-group">
                  <label data-i18n="ingredientes:form_label_unit">Unidad</label>
                  <select id="ing-unidad">
                    <option value="kg">kg</option>
                    <option value="g">g</option>
                    <option value="l">L</option>
                    <option value="ml">ml</option>
                    <option value="unidad" data-i18n="ingredientes:form_unit_units">Unidades</option>
                    <option value="botella" data-i18n="ingredientes:form_unit_bottle">Botella</option>
                    <option value="docena" data-i18n="ingredientes:form_unit_dozen">Docena</option>
                  </select>
                </div>
                <div class="form-group">
                  <label data-i18n="ingredientes:form_label_family">Familia</label>
                  <select id="ing-familia">
                    <option value="alimento" data-i18n="ingredientes:form_family_food">Alimento</option>
                    <option value="bebida" data-i18n="ingredientes:form_family_drink">Bebida</option>
                    <option value="suministro" data-i18n="ingredientes:form_family_supply">Suministro</option>
                  </select>
                </div>
                <div class="form-group">
                  <label data-i18n="ingredientes:form_label_stock">Stock actual</label>
                  <input type="number" id="ing-stockActual" step="0.01" min="0">
                </div>
                <div class="form-group">
                  <label data-i18n="ingredientes:form_label_stock_min">Stock m√≠nimo</label>
                  <input type="number" id="ing-stockMinimo" step="0.01" min="0">
                </div>

                <!-- RENDIMIENTO / MERMA (Moved to bottom with Slider) -->
                <div class="form-group"
                  style="grid-column: span 2; margin-top: 10px; padding: 15px; background: #f8fafc; border-radius: 10px; border: 1px solid #e2e8f0;">
                  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <label style="margin: 0; color: #334155; font-weight: 600;" data-i18n="ingredientes:form_label_yield">Rendimiento / Aprovechamiento
                      (%)</label>
                    <span id="ing-rendimiento-val"
                      style="font-weight: bold; color: #7c3aed; font-size: 1.1em;">100%</span>
                  </div>
                  <div style="display: flex; gap: 15px; align-items: center;">
                    <span style="font-size: 12px; color: #ef4444;" data-i18n="ingredientes:form_yield_all_waste">0% (Todo merma)</span>
                    <input type="range" id="ing-rendimiento-slider" min="1" max="100" value="100" step="1"
                      style="flex: 1; accent-color: #7c3aed; cursor: pointer;">
                    <span style="font-size: 12px; color: #10b981;" data-i18n="ingredientes:form_yield_all_useful">100% (Todo √∫til)</span>
                  </div>
                  <input type="number" id="ing-rendimiento" step="1" min="1" max="100" value="100"
                    style="display: none;"> <!-- Hidden sync input -->
                  <p style="font-size: 11px; color: #64748b; margin-top: 8px;" data-i18n-html="ingredientes:form_yield_help">
                    ‚ÑπÔ∏è Define qu√© porcentaje del producto realmente usas. <br>
                    Ej: Si compras 1kg de carne y limpias 200g de grasa, el rendimiento es <strong>80%</strong>.
                  </p>
                </div>

                <!-- Formato de compra (opcional) -->
                <div class="form-group"
                  style="grid-column: span 2; margin-top: 10px; padding-top: 15px; border-top: 1px dashed #e2e8f0;">
                  <label style="font-weight: 600; color: #7c3aed;" data-i18n="ingredientes:form_format_title">üì¶ Formato de compra (opcional)</label>
                  <p style="font-size: 12px; color: #64748b; margin: 5px 0 10px;" data-i18n="ingredientes:form_format_hint">Facilita los pedidos indicando c√≥mo
                    compras este producto</p>
                </div>
                <div class="form-group">
                  <label data-i18n="ingredientes:form_format_label">Formato</label>
                  <input type="text" id="ing-formato-compra" placeholder="ej: bote, garrafa, caja..." data-i18n-placeholder="ingredientes:form_format_placeholder">
                </div>
                <div class="form-group">
                  <label data-i18n="ingredientes:form_format_quantity">Cantidad por formato</label>
                  <input type="number" id="ing-cantidad-formato" step="0.01" min="0"
                    placeholder="ej: 0.65 (kg), 10 (L)..." data-i18n-placeholder="ingredientes:form_format_qty_placeholder">
                </div>
              </div>
              <div class="form-actions">
                <button type="button" class="btn btn-secondary" data-action="cerrar-form-ingrediente" data-i18n="common:btn_cancel">Cancelar</button>
                <button type="submit" class="btn btn-primary"><span id="btn-text-ingrediente" data-i18n="common:btn_add">A√±adir</span></button>
              </div>
            </form>
          </div>
          <div id="tabla-ingredientes"></div>
          <div id="resumen-ingredientes" class="summary" style="display: none;"></div>
        </div>

        <!-- TAB: RECETAS (simplificado) -->
        <div id="tab-recetas" class="tab-content">
          <div class="top-bar">
            <div>
              <h2 data-i18n="recetas:title">Recetas</h2>
              <p data-i18n="recetas:description">Crea recetas y calcula costes</p>
            </div>
            <div style="display: flex; gap: 10px;">
              <button class="btn btn-primary" data-action="mostrar-form-receta" data-i18n="recetas:btn_new">‚ûï Nueva Receta</button>
              <button class="btn btn-secondary" data-action="importar-recetas" data-i18n="common:btn_import_excel">üì§ Importar Excel</button>
              <button class="btn btn-secondary" data-action="exportar-recetas" data-i18n="common:btn_export_excel">üì• Exportar Excel</button>
              <button class="btn" onclick="window.mostrarCostTracker()"
                style="background: linear-gradient(135deg, #7C3AED, #5B21B6); color: white;">üìä <span data-i18n="recetas:btn_cost_tracking">Seguimiento Costes</span></button>
            </div>
          </div>
          <div class="search-box">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <circle cx="11" cy="11" r="8" />
              <path d="m21 21-4.35-4.35" />
            </svg>
            <input type="search" id="busqueda-recetas" name="busqueda_rec_nocache" placeholder="Buscar..." data-i18n-placeholder="common:search_placeholder"
              autocomplete="off" oninput="window.renderizarRecetas()">
          </div>

          <!-- Filtros por categor√≠a -->
          <div id="filtros-recetas" style="display: flex; gap: 8px; margin: 0 0 16px 0; flex-wrap: wrap;">
            <span
              style="font-size: 14px; font-weight: 500; color: #64748b; display: flex; align-items: center;" data-i18n="recetas:filter_label">Filtrar:</span>
            <button class="filter-btn active" data-filter="todas" onclick="window.filtrarRecetasPorCategoria('todas')"
              style="padding: 6px 14px; border-radius: 20px; border: 1px solid #e2e8f0; background: #f1f5f9; color: #475569; font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s;">
              <span data-i18n="recetas:filter_all">üîÑ Todas</span>
            </button>
            <button class="filter-btn" data-filter="alimentos" onclick="window.filtrarRecetasPorCategoria('alimentos')"
              style="padding: 6px 14px; border-radius: 20px; border: 1px solid #22c55e; background: white; color: #22c55e; font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s;">
              <span data-i18n="recetas:filter_food">ü•ó Alimentos</span>
            </button>
            <button class="filter-btn" data-filter="bebida" onclick="window.filtrarRecetasPorCategoria('bebida')"
              style="padding: 6px 14px; border-radius: 20px; border: 1px solid #3b82f6; background: white; color: #3b82f6; font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s;">
              <span data-i18n="recetas:filter_drinks">üç∫ Bebidas</span>
            </button>
            <button class="filter-btn" data-filter="base" onclick="window.filtrarRecetasPorCategoria('base')"
              style="padding: 6px 14px; border-radius: 20px; border: 1px solid #7c3aed; background: white; color: #7c3aed; font-size: 13px; font-weight: 500; cursor: pointer; transition: all 0.2s;">
              <span data-i18n="recetas:filter_base">üß™ Base</span>
            </button>
          </div>
          <div id="formulario-receta" class="form-card" style="display: none;">
            <h3>
              <span id="form-title-receta" data-i18n="recetas:form_title_new">Nueva Receta</span>
              <button class="close-btn" data-action="cerrar-form-receta">√ó</button>
            </h3>
            <form onsubmit="window.guardarReceta(event)">
              <div class="form-grid">
                <div class="form-group">
                  <label data-i18n="common:label_name_required">Nombre *</label>
                  <input type="text" id="rec-nombre" required>
                </div>
                <div class="form-group">
                  <label data-i18n="recetas:form_label_code">C√≥digo TPV</label>
                  <input type="text" id="rec-codigo" placeholder="Ej: 101" data-i18n-placeholder="recetas:form_code_placeholder">
                </div>
                <div class="form-group">
                  <label data-i18n="common:label_category">Categor√≠a</label>
                  <select id="rec-categoria">
                    <option value="alimentos" data-i18n="recetas:form_category_food">Alimentos</option>
                    <option value="bebidas" data-i18n="recetas:form_category_drinks">Bebidas</option>
                    <option value="base" data-i18n="recetas:form_category_base">üß™ Preparaci√≥n Base</option>
                    <option value="suministros" data-i18n="recetas:form_category_supplies">Suministros</option>
                  </select>
                </div>
                <div class="form-group">
                  <label data-i18n="recetas:form_label_sale_price">Precio venta (‚Ç¨)</label>
                  <input type="number" id="rec-precio_venta" step="0.01" min="0" oninput="window.calcularCosteReceta()">
                </div>
                <div class="form-group">
                  <label data-i18n="recetas:form_label_servings">Porciones</label>
                  <input type="number" id="rec-porciones" min="1" value="1" onchange="window.calcularCosteReceta?.()"
                    oninput="window.calcularCosteReceta?.()">
                </div>
              </div>
              <div class="ingredientes-receta">
                <h4 data-i18n="common:nav_ingredientes">Ingredientes</h4>
                <div id="lista-ingredientes-receta"></div>
                <button type="button" class="btn btn-secondary btn-small" data-action="agregar-ingrediente-receta" data-i18n="recetas:form_add_ingredient">+
                  A√±adir</button>
              </div>
              <div id="coste-calculado-form" class="coste-calculado" style="display: none;">
                <!-- Panel de An√°lisis de Costes - Dise√±o Premium -->
                <div
                  style="background: linear-gradient(135deg, #059669 0%, #047857 100%); border-radius: 16px; padding: 20px; color: white; margin-bottom: 10px;">
                  <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 20px;">
                    <span style="font-size: 28px;">üìä</span>
                    <div>
                      <h4 style="margin: 0; font-size: 18px; font-weight: 700;" data-i18n="recetas:form_analysis_title">An√°lisis Financiero</h4>
                      <p style="margin: 0; font-size: 13px; opacity: 0.9;" data-i18n="recetas:form_analysis_subtitle">Rentabilidad en tiempo real</p>
                    </div>
                  </div>

                  <!-- Coste Total -->
                  <div
                    style="background: rgba(255,255,255,0.15); border-radius: 12px; padding: 16px; margin-bottom: 12px; backdrop-filter: blur(10px);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                      <div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                          <span style="font-size: 20px;">üí∞</span>
                          <span style="font-size: 15px; font-weight: 600;" data-i18n="recetas:form_production_cost">Coste de Producci√≥n</span>
                        </div>
                        <p style="margin: 4px 0 0 28px; font-size: 12px; opacity: 0.85;" data-i18n="recetas:form_production_cost_hint">
                          Calculado con precio medio de compra
                        </p>
                      </div>
                      <div style="text-align: right;">
                        <strong id="coste-receta-valor" style="font-size: 28px; font-weight: 800;">0.00‚Ç¨</strong>
                      </div>
                    </div>
                  </div>

                  <!-- Food Cost % -->
                  <div
                    style="background: rgba(255,255,255,0.15); border-radius: 12px; padding: 16px; margin-bottom: 12px; backdrop-filter: blur(10px);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                      <div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                          <span style="font-size: 20px;">üéØ</span>
                          <span style="font-size: 15px; font-weight: 600;" data-i18n="common:label_food_cost">Food Cost</span>
                        </div>
                        <p style="margin: 4px 0 0 28px; font-size: 12px; opacity: 0.85;" data-i18n="recetas:form_food_cost_hint">
                          % del precio que es coste (‚â§33% ideal)
                        </p>
                      </div>
                      <div style="text-align: right;">
                        <strong id="foodcost-receta-valor" style="font-size: 28px; font-weight: 800;">0.0%</strong>
                      </div>
                    </div>
                  </div>

                  <!-- Margen -->
                  <div
                    style="background: rgba(255,255,255,0.15); border-radius: 12px; padding: 16px; backdrop-filter: blur(10px);">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                      <div>
                        <div style="display: flex; align-items: center; gap: 8px;">
                          <span style="font-size: 20px;">üìà</span>
                          <span style="font-size: 15px; font-weight: 600;" data-i18n="recetas:form_margin_label">Margen de Beneficio</span>
                        </div>
                        <p style="margin: 4px 0 0 28px; font-size: 12px; opacity: 0.85;" data-i18n="recetas:form_margin_hint">
                          Beneficio por cada venta
                        </p>
                      </div>
                      <div style="text-align: right;">
                        <strong id="margen-receta-valor" style="font-size: 28px; font-weight: 800;">0.0%</strong>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="form-actions">
                <button type="button" class="btn btn-secondary" data-action="cerrar-form-receta" data-i18n="common:btn_cancel">Cancelar</button>
                <button type="submit" class="btn btn-primary"><span id="btn-text-receta" data-i18n="common:btn_save">Guardar</span></button>
              </div>
            </form>
          </div>
          <div id="tabla-recetas"></div>
          <div id="resumen-recetas" class="summary" style="display: none;"></div>
        </div>

        <!-- TAB: PROVEEDORES (simplificado) -->
        <div id="tab-proveedores" class="tab-content">
          <div class="top-bar">
            <div>
              <h2 data-i18n="proveedores:title">Proveedores</h2>
              <p data-i18n="proveedores:description">Gestiona tus proveedores</p>
            </div>
            <button class="btn btn-primary" data-action="mostrar-form-proveedor" data-i18n="proveedores:btn_new">+ A√±adir Proveedor</button>
          </div>
          <div class="search-box">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <circle cx="11" cy="11" r="8" />
              <path d="m21 21-4.35-4.35" />
            </svg>
            <input type="search" id="busqueda-proveedores" name="busqueda_prov_nocache" placeholder="Buscar..." data-i18n-placeholder="common:search_placeholder"
              autocomplete="off" oninput="window.renderizarProveedores()">
          </div>
          <div id="formulario-proveedor" class="form-card" style="display: none;">
            <h3>
              <span id="form-title-proveedor" data-i18n="proveedores:form_title_new">Nuevo Proveedor</span>
              <button class="close-btn" data-action="cerrar-form-proveedor">√ó</button>
            </h3>
            <form onsubmit="window.guardarProveedor(event)">
              <div class="form-grid">
                <div class="form-group">
                  <label data-i18n="common:label_name_required">Nombre *</label>
                  <input type="text" id="prov-nombre" required>
                </div>
                <div class="form-group">
                  <label data-i18n="proveedores:form_label_contact">Contacto</label>
                  <input type="text" id="prov-contacto">
                </div>
                <div class="form-group">
                  <label data-i18n="proveedores:form_label_phone">Tel√©fono</label>
                  <input type="tel" id="prov-telefono">
                </div>
                <div class="form-group">
                  <label data-i18n="common:label_email">Email</label>
                  <input type="email" id="prov-email">
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                  <label data-i18n="proveedores:form_label_address">Direcci√≥n</label>
                  <textarea id="prov-direccion"></textarea>
                </div>
                <div class="form-group" style="grid-column: 1 / -1;">
                  <label data-i18n="proveedores:form_label_notes">Notas</label>
                  <textarea id="prov-notas"></textarea>
                </div>
              </div>
              <div class="selector-ingredientes">
                <h4 data-i18n="proveedores:form_supplies_title">Ingredientes que suministra</h4>
                <div class="search-box" style="margin-bottom: 10px;">
                  <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <circle cx="11" cy="11" r="8" />
                    <path d="m21 21-4.35-4.35" />
                  </svg>
                  <input type="text" id="buscar-ingredientes-proveedor" placeholder="Buscar..." data-i18n-placeholder="common:search_placeholder"
                    oninput="window.filtrarIngredientesProveedor()">
                </div>
                <div class="ingredientes-disponibles" id="lista-ingredientes-proveedor"></div>
              </div>
              <div class="form-actions">
                <button type="button" class="btn btn-secondary" data-action="cerrar-form-proveedor" data-i18n="common:btn_cancel">Cancelar</button>
                <button type="submit" class="btn btn-primary"><span id="btn-text-proveedor" data-i18n="common:btn_add">A√±adir</span></button>
              </div>
            </form>
          </div>
          <div id="tabla-proveedores"></div>
          <div id="resumen-proveedores" class="summary" style="display: none;"></div>
        </div>

        <!-- TAB: PEDIDOS -->
        <div id="tab-pedidos" class="tab-content">
          <div class="top-bar">
            <div>
              <h2 data-i18n="pedidos:tab_title">Pedidos a Proveedores</h2>
              <p data-i18n="pedidos:description">Gestiona tus pedidos y actualiza stock autom√°ticamente</p>
            </div>
            <div style="display: flex; gap: 10px;">
              <button class="btn btn-primary" data-action="mostrar-form-pedido" data-i18n="pedidos:btn_new">+ Nuevo Pedido</button>
              <button class="btn" onclick="window.abrirCarrito()"
                style="background: linear-gradient(135deg, #f97316, #ea580c); border: none; color: white; position: relative;">
                <span data-i18n="pedidos:btn_cart">üõí Carrito</span>
                <span id="carrito-badge"
                  style="display: none; background: #22c55e; color: white; font-size: 10px; padding: 2px 6px; border-radius: 10px; justify-content: center; align-items: center; position: absolute; top: -8px; right: -8px; font-weight: 700;"></span>
              </button>
              <button class="btn btn-secondary" data-action="importar-pedidos" data-i18n="pedidos:btn_import_orders">üì§ Importar
                Pedidos</button>
            </div>
          </div>

          <div class="search-box">
            <svg width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
              <circle cx="11" cy="11" r="8" />
              <path d="m21 21-4.35-4.35" />
            </svg>
            <input type="search" id="busqueda-pedidos" name="busqueda_ped_nocache" placeholder="Buscar pedidos..." data-i18n-placeholder="pedidos:search_placeholder"
              autocomplete="off" oninput="window.renderizarPedidos()">
          </div>

          <!-- üì∏ Escanear albar√°n con IA -->
          <div id="albaran-scanner-section" style="margin-bottom: 20px;">
            <div id="albaran-dropzone" ondrop="window.procesarFotoAlbaran(event)"
              ondragover="event.preventDefault(); this.style.borderColor='#3b82f6'; this.style.background='#eff6ff';"
              ondragleave="this.style.borderColor='#cbd5e1'; this.style.background='';"
              onclick="document.getElementById('albaran-foto-input').click()"
              style="border: 2px dashed #cbd5e1; border-radius: 12px; padding: 24px; text-align: center; cursor: pointer; transition: all 0.2s; background: transparent;">
              <input type="file" id="albaran-foto-input" accept="image/*,.pdf" style="display:none"
                onchange="window.procesarFotoAlbaranInput(event)">
              <div id="albaran-dropzone-content"
                style="display: flex; align-items: center; justify-content: center; gap: 10px; color: #64748b; font-size: 14px; font-weight: 500;">
                üì∏ <span data-i18n="pedidos:scanner_drag_hint">Arrastra aqu√≠ un albar√°n (foto o PDF) para escanearlo con IA</span>
              </div>
              <div id="albaran-dropzone-loading"
                style="display: none; color: #3b82f6; font-weight: 600; font-size: 14px;">
                <span data-i18n="pedidos:scanner_analyzing">‚è≥ Analizando albar√°n con IA... (10-20 seg)</span>
              </div>
            </div>
          </div>

          <!-- Panel de Compras Pendientes (revisi√≥n de albaranes importados por n8n) -->
          <div id="compras-pendientes-panel" style="display: none; margin-bottom: 20px;"></div>

          <div id="formulario-pedido" class="form-card" style="display: none;">
            <h3>
              <span data-i18n="pedidos:form_title_new">Nuevo Pedido</span>
              <button class="close-btn" data-action="cerrar-form-pedido">√ó</button>
            </h3>
            <form onsubmit="window.guardarPedido(event)">
              <!-- Buscador de ingrediente (nuevo) -->
              <div class="form-group"
                style="margin-bottom: 20px; padding: 16px; background: linear-gradient(135deg, #eef2ff 0%, #e0e7ff 100%); border-radius: 12px; border: 2px solid #818cf8;">
                <label
                  style="color: #4338ca; font-weight: 600; font-size: 13px; display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
                  üîç Buscar por ingrediente <small style="font-weight: 400; color: #6366f1;" data-i18n="pedidos:form_search_ingredient_hint">(opcional - auto-selecciona
                    proveedor)</small>
                </label>
                <input type="text" id="ped-buscar-ingrediente" placeholder="Escribe nombre del ingrediente..." data-i18n-placeholder="pedidos:form_search_ingredient_placeholder"
                  autocomplete="off" oninput="window.buscarIngredienteParaPedido(this.value)"
                  style="width: 100%; padding: 12px; border: 2px solid #a5b4fc; border-radius: 8px; background: white; font-size: 14px;">
                <div id="sugerencias-ingrediente-pedido"
                  style="display:none; margin-top: 8px; max-height: 200px; overflow-y: auto;"></div>
              </div>

              <div class="form-grid">
                <div class="form-group">
                  <label data-i18n="pedidos:form_supplier_required">Proveedor *</label>
                  <select id="ped-proveedor" required onchange="window.cargarIngredientesPedido()">
                    <option value="" data-i18n="pedidos:form_select_supplier">Seleccionar proveedor...</option>
                  </select>
                </div>
                <div class="form-group">
                  <label data-i18n="pedidos:form_order_date">Fecha del pedido</label>
                  <input type="date" id="ped-fecha" required>
                </div>
              </div>

              <!-- Info del puesto del mercado (oculto por defecto) -->
              <div id="campo-detalle-mercado"
                style="display: none; margin-top: 12px; padding: 16px; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border: 2px solid #10b981; border-radius: 12px;">
                <div class="form-group" style="margin: 0;">
                  <label
                    style="color: #047857; font-weight: 600; font-size: 13px; display: flex; align-items: center; gap: 8px;">
                    <span data-i18n="pedidos:form_market_stall">üè™ Puesto del Mercado</span> <small style="font-weight: 400; color: #059669;" data-i18n="pedidos:form_market_stall_hint">(opcional)</small>
                  </label>
                  <input type="text" id="ped-mercado-puesto" placeholder="Ej: Pescader√≠a Pepe, Fruter√≠a Mar√≠a..." data-i18n-placeholder="pedidos:form_market_stall_placeholder"
                    style="width: 100%; padding: 10px; border: 2px solid #86efac; border-radius: 8px; background: white; margin-top: 6px;">
                  <small style="color: #059669; margin-top: 6px; display: block;">
                    <span data-i18n="pedidos:form_market_stock_hint">‚úÖ Selecciona ingredientes abajo, pon cantidad y precio, y el stock se actualizar√° autom√°ticamente.</span>
                  </small>
                </div>
              </div>

              <div class="ingredientes-receta" id="container-ingredientes-pedido" style="display:none;">
                <h4 data-i18n="pedidos:form_ingredients_title">Ingredientes del pedido</h4>
                <div id="lista-ingredientes-pedido"></div>
                <button type="button" class="btn btn-secondary btn-small" data-action="agregar-ingrediente-pedido" data-i18n="pedidos:form_add_ingredient">+
                  A√±adir ingrediente</button>
              </div>

              <!-- IVA y Totales -->
              <div id="total-pedido-form"
                style="display:none; margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border: 2px solid #10b981; border-radius: 12px;">
                <div
                  style="display: flex; gap: 20px; align-items: flex-end; flex-wrap: wrap; justify-content: flex-end;">
                  <!-- Campo IVA -->
                  <div style="flex: 0 0 auto;">
                    <label data-i18n="pedidos:form_iva_label"
                      style="font-size: 12px; font-weight: 600; color: #047857; display: block; margin-bottom: 4px;">IVA
                      %</label>
                    <input type="number" id="ped-iva" placeholder="0" step="0.5" min="0" max="21" value="0"
                      style="width: 70px; padding: 10px; border: 2px solid #86efac; border-radius: 8px; text-align: center; font-weight: 600; font-size: 16px;"
                      oninput="window.calcularTotalPedido()">
                  </div>

                  <!-- Desglose -->
                  <div style="flex: 1; min-width: 200px; text-align: right;">
                    <div style="display: flex; justify-content: flex-end; gap: 15px; font-size: 14px; color: #059669;">
                      <span><span data-i18n="pedidos:form_subtotal">Subtotal</span>: <strong id="total-pedido-subtotal">0.00 ‚Ç¨</strong></span>
                      <span><span data-i18n="pedidos:form_iva_amount">IVA</span>: <strong id="total-pedido-iva">0.00 ‚Ç¨</strong></span>
                    </div>
                    <div style="margin-top: 8px;">
                      <span style="font-size: 13px; color: #047857;" data-i18n="pedidos:form_total">Total:</span>
                      <strong id="total-pedido-value" style="font-size: 28px; color: #059669; margin-left: 10px;">0.00
                        ‚Ç¨</strong>
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-actions" style="margin-top: 20px;">
                <button type="button" class="btn btn-secondary" data-action="cerrar-form-pedido" data-i18n="common:btn_cancel">Cancelar</button>
                <button type="submit" class="btn btn-primary" data-i18n="pedidos:btn_create">Crear Pedido</button>
              </div>
            </form>
          </div>

          <div id="tabla-pedidos"></div>
          <div id="resumen-pedidos" class="summary" style="display: none;"></div>
        </div>

        <!-- TAB: AN√ÅLISIS -->
        <div id="tab-analisis" class="tab-content">
          <div class="chart-container">
            <div class="chart-header">
              <h3 data-i18n="dashboard:analysis_revenue_vs_expenses">üìä Ingresos vs Gastos</h3>
              <p data-i18n="dashboard:analysis_financial_evolution">Evoluci√≥n financiera de los √∫ltimos 7 d√≠as</p>
            </div>
            <canvas id="revenueChart"></canvas>
          </div>

          <div id="analisis-vacio" class="empty-state">
            <div class="icon">üìä</div>
            <h3 data-i18n="dashboard:analysis_no_data">A√∫n no hay datos</h3>
            <p data-i18n="dashboard:analysis_add_data_hint">A√±ade ingredientes y recetas</p>
          </div>

          <div id="analisis-contenido" style="display: none;">
            <div class="stats-grid">
              <div class="stat-card">
                <h3 data-i18n="dashboard:analysis_total_recipes">Total Recetas</h3>
                <div class="value" id="stat-total-recetas">0</div>
              </div>
              <div class="stat-card green">
                <h3 data-i18n="dashboard:analysis_avg_margin">Margen Promedio</h3>
                <div class="value" id="stat-margen-promedio">0%</div>
              </div>
              <div class="stat-card blue">
                <h3 data-i18n="dashboard:analysis_avg_cost">Coste Promedio</h3>
                <div class="value" id="stat-coste-promedio">0 ‚Ç¨</div>
              </div>
              <div class="stat-card orange">
                <h3 data-i18n="dashboard:analysis_total_ingredients">Total Ingredientes</h3>
                <div class="value" id="stat-total-ingredientes">0</div>
              </div>
            </div>
            <div class="charts-grid charts-grid-compact">
              <div class="chart-card chart-card-compact">
                <h3 data-i18n="dashboard:analysis_profitability">üìä Rentabilidad por Plato</h3>
                <canvas id="chart-rentabilidad"></canvas>
              </div>
              <div class="chart-card chart-card-compact">
                <h3 data-i18n="dashboard:analysis_expensive_food">ü•¨ Alimentos M√°s Caros</h3>
                <canvas id="chart-ingredientes"></canvas>
              </div>
              <div class="chart-card chart-card-compact">
                <h3 data-i18n="dashboard:analysis_expensive_drinks">üç∫ Bebidas M√°s Caras</h3>
                <canvas id="chart-bebidas"></canvas>
              </div>
              <div class="chart-card chart-card-compact">
                <h3 data-i18n="dashboard:analysis_margin_category">üìà Margen por Categor√≠a</h3>
                <canvas id="chart-margen-categoria"></canvas>
              </div>
            </div>
            <div class="chart-card">
              <h3 data-i18n="dashboard:analysis_profitability_ranking">Ranking de Rentabilidad</h3>
              <div id="tabla-rentabilidad"></div>
            </div>

            <!-- Matriz BCG - Redise√±o Profesional -->
            <div class="chart-card" id="bcg-matrix-container" style="margin-top: 20px;">
              <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <div>
                  <h3 style="margin: 0;" data-i18n="dashboard:bcg_title">üèÜ Ingenier√≠a de Men√∫</h3>
                  <p style="margin: 5px 0 0; font-size: 13px; color: #64748b;" data-i18n="dashboard:bcg_subtitle">Optimiza tu carta con datos reales</p>
                </div>
                <div style="display: flex; gap: 8px;">
                  <span class="bcg-legend-item" style="--color: #22c55e;" data-i18n="dashboard:bcg_legend_stars">‚≠ê Estrellas</span>
                  <span class="bcg-legend-item" style="--color: #3b82f6;" data-i18n="dashboard:bcg_legend_puzzles">‚ùì Puzzles</span>
                  <span class="bcg-legend-item" style="--color: #f97316;" data-i18n="dashboard:bcg_legend_horses">üêé Caballos</span>
                  <span class="bcg-legend-item" style="--color: #ef4444;" data-i18n="dashboard:bcg_legend_dogs">üê∂ Perros</span>
                </div>
              </div>

              <!-- Scatter Plot Container - FULL WIDTH -->
              <div style="display: block;">
                <!-- Gr√°fico Scatter Grande -->
                <div
                  style="background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%); border-radius: 16px; padding: 20px;">
                  <canvas id="bcg-scatter-chart" style="width: 100%; height: 400px;"></canvas>
                </div>

                <!-- Panel de Acciones R√°pidas -->
                <div style="display: flex; flex-direction: column; gap: 12px;">
                  <!-- Acci√≥n Estrellas -->
                  <div class="bcg-action-card bcg-action-estrella" data-action="toggle-expand">
                    <div class="bcg-action-header">
                      <span class="bcg-action-icon">‚≠ê</span>
                      <span class="bcg-action-title" data-i18n="dashboard:bcg_stars">Estrellas</span>
                      <span class="bcg-action-count" id="count-estrella">0</span>
                      <span class="bcg-expand-icon">‚ñº</span>
                    </div>
                    <div class="bcg-action-text" data-i18n="dashboard:bcg_stars_action">Mant√©n y destaca</div>
                    <div class="bcg-action-detail" id="detail-estrella" data-i18n-html="dashboard:bcg_stars_detail">
                      <strong>Estrategia recomendada:</strong>
                      <ul>
                        <li>Mant√©n la calidad constante</li>
                        <li>Dest√°calos en el men√∫ principal</li>
                        <li>Considera subir precio (+5-10%)</li>
                        <li>Capacita al equipo para recomendarlos</li>
                        <li>Usa fotos en redes sociales</li>
                      </ul>
                    </div>
                  </div>

                  <!-- Acci√≥n Puzzles -->
                  <div class="bcg-action-card bcg-action-puzzle" data-action="toggle-expand">
                    <div class="bcg-action-header">
                      <span class="bcg-action-icon">‚ùì</span>
                      <span class="bcg-action-title" data-i18n="dashboard:bcg_puzzles">Puzzles</span>
                      <span class="bcg-action-count" id="count-puzzle">0</span>
                      <span class="bcg-expand-icon">‚ñº</span>
                    </div>
                    <div class="bcg-action-text" data-i18n="dashboard:bcg_puzzles_action">Promociona m√°s</div>
                    <div class="bcg-action-detail" id="detail-puzzle" data-i18n-html="dashboard:bcg_puzzles_detail">
                      <strong>Estrategia recomendada:</strong>
                      <ul>
                        <li>Mejora la visibilidad en la carta</li>
                        <li>A√±ade foto profesional</li>
                        <li>Forma al personal para recomendarlos</li>
                        <li>Crea combos con platos populares</li>
                        <li>Si no mejoran, eval√∫a retirarlos</li>
                      </ul>
                    </div>
                  </div>

                  <!-- Acci√≥n Caballos -->
                  <div class="bcg-action-card bcg-action-caballo" data-action="toggle-expand">
                    <div class="bcg-action-header">
                      <span class="bcg-action-icon">üêé</span>
                      <span class="bcg-action-title" data-i18n="dashboard:bcg_horses">Caballos</span>
                      <span class="bcg-action-count" id="count-caballo">0</span>
                      <span class="bcg-expand-icon">‚ñº</span>
                    </div>
                    <div class="bcg-action-text" data-i18n="dashboard:bcg_horses_action">Sube el precio</div>
                    <div class="bcg-action-detail" id="detail-caballo" data-i18n-html="dashboard:bcg_horses_detail">
                      <strong>‚ö†Ô∏è Atenci√≥n:</strong> Trabajan mucho pero ganan poco.
                      <ul>
                        <li>Sube el precio gradualmente (5-10%)</li>
                        <li>Renegocia con proveedores</li>
                        <li>Reduce porciones sin afectar percepci√≥n</li>
                        <li>Usa ingredientes m√°s econ√≥micos</li>
                        <li>Candidatos a retirar si no mejoran</li>
                      </ul>
                    </div>
                  </div>

                  <!-- Acci√≥n Perros -->
                  <div class="bcg-action-card bcg-action-perro" data-action="toggle-expand">
                    <div class="bcg-action-header">
                      <span class="bcg-action-icon">üê∂</span>
                      <span class="bcg-action-title" data-i18n="dashboard:bcg_dogs">Perros</span>
                      <span class="bcg-action-count" id="count-perro">0</span>
                      <span class="bcg-expand-icon">‚ñº</span>
                    </div>
                    <div class="bcg-action-text" data-i18n="dashboard:bcg_dogs_action">Retira o reforma</div>
                    <div class="bcg-action-detail" id="detail-perro" data-i18n-html="dashboard:bcg_dogs_detail">
                      <strong>üö® Acci√≥n urgente:</strong> Ocupan espacio sin aportar valor.
                      <ul>
                        <li>Ret√≠ralos del men√∫ cuanto antes</li>
                        <li>Liberan inventario y tiempo de cocina</li>
                        <li>Si tienen valor sentimental: especial del d√≠a</li>
                        <li>Reformula completamente la receta</li>
                        <li>Redirige recursos a tus Estrellas</li>
                      </ul>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Panel de Recomendaciones Inteligentes -->
              <div id="bcg-recommendations"
                style="margin-top: 20px; padding: 16px; background: linear-gradient(135deg, #ede9fe 0%, #ddd6fe 100%); border-radius: 12px; border: 1px solid #c4b5fd;">
                <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                  <span style="font-size: 20px;">üí°</span>
                  <strong style="color: #5b21b6;" data-i18n="dashboard:bcg_recommendations">Recomendaciones Inteligentes</strong>
                </div>
                <div id="bcg-recommendations-list" style="font-size: 13px; color: #4c1d95; line-height: 1.6;"></div>
              </div>

              <!-- Lista detallada colapsable -->
              <details style="margin-top: 16px;">
                <summary style="cursor: pointer; font-weight: 600; color: #64748b; padding: 10px 0;" data-i18n="dashboard:bcg_detailed_list">
                  üìã Ver lista detallada de platos por categor√≠a
                </summary>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                  <!-- Estrellas -->
                  <div style="background: #f0fdf4; padding: 15px; border-radius: 12px; border: 2px solid #22c55e;">
                    <h4 style="color: #15803d; margin: 0 0 10px 0; font-size: 14px;" data-i18n="dashboard:bcg_legend_stars">‚≠ê Estrellas</h4>
                    <div id="lista-estrella" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                  </div>
                  <!-- Puzzles -->
                  <div style="background: #eff6ff; padding: 15px; border-radius: 12px; border: 2px solid #3b82f6;">
                    <h4 style="color: #1d4ed8; margin: 0 0 10px 0; font-size: 14px;" data-i18n="dashboard:bcg_legend_puzzles">‚ùì Puzzles</h4>
                    <div id="lista-puzzle" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                  </div>
                  <!-- Caballos -->
                  <div style="background: #fff7ed; padding: 15px; border-radius: 12px; border: 2px solid #f97316;">
                    <h4 style="color: #c2410c; margin: 0 0 10px 0; font-size: 14px;" data-i18n="dashboard:bcg_legend_horses">üêé Caballos</h4>
                    <div id="lista-caballo" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                  </div>
                  <!-- Perros -->
                  <div style="background: #fef2f2; padding: 15px; border-radius: 12px; border: 2px solid #ef4444;">
                    <h4 style="color: #b91c1c; margin: 0 0 10px 0; font-size: 14px;" data-i18n="dashboard:bcg_legend_dogs">üê∂ Perros</h4>
                    <div id="lista-perro" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                  </div>
                </div>
              </details>

              <!-- BCG Chart CSS: extra√≠do a styles/finance.css -->
            </div>
          </div>
        </div>

        <!-- TAB: INVENTARIO -->
        <div id="tab-inventario" class="tab-content">
          <div class="top-bar">
            <div>
              <h2 data-i18n="inventario:title">üì¶ Inventario</h2>
              <p data-i18n="inventario:description">Control de stock de ingredientes</p>
            </div>
          </div>

          <div style="margin-bottom: 15px;">
            <button class="btn btn-secondary" data-action="mostrar-modal-inventario-masivo" data-i18n="inventario:btn_update_bulk">üìä ACTUALIZAR INVENTARIO
              MASIVO</button>
            <button class="btn btn-primary" data-action="guardar-cambios-stock" data-i18n="inventario:btn_save_stock">üíæ Guardar Stock</button>
            <button class="btn" style="background: linear-gradient(135deg, #EF4444, #DC2626); color: white;"
              data-action="mostrar-modal-merma-rapida" data-i18n="inventario:btn_quick_waste">üóëÔ∏è Merma R√°pida</button>
            <button class="btn" style="background: linear-gradient(135deg, #8B5CF6, #7C3AED); color: white;"
              data-action="ver-historial-mermas" data-i18n="inventario:btn_waste_history">üìã Ver Historial Mermas</button>
          </div>

          <div id="resumen-inventario" style="display: none; gap: 20px;"></div>


          <div class="card">
            <div style="margin-bottom: 20px;">
              <div style="position: relative; max-width: 500px;">
                <span
                  style="position: absolute; left: 16px; top: 50%; transform: translateY(-50%); font-size: 1.2rem; color: #9CA3AF;">üîç</span>
                <input type="text" id="busqueda-inventario" placeholder="Buscar ingrediente..." data-i18n-placeholder="inventario:search_placeholder"
                  style="width: 100%; padding: 14px 16px 14px 48px; border: 2px solid #E5E7EB; border-radius: 12px; font-size: 1rem; background: #F9FAFB; transition: all 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.05);"
                  onfocus="this.style.borderColor='#F97316'; this.style.boxShadow='0 0 0 4px rgba(249,115,22,0.1)';"
                  onblur="this.style.borderColor='#E5E7EB'; this.style.boxShadow='0 1px 3px rgba(0,0,0,0.05)';">
              </div>
            </div>

            <div id="tabla-inventario"></div>
          </div>
        </div>
        <!-- TAB: VENTAS -->
        <div id="tab-ventas" class="tab-content">
          <div class="top-bar">
            <div>
              <h2 data-i18n="ventas:title">üí∞ Ventas</h2>
              <p data-i18n="ventas:description">Registro diario de ventas</p>
            </div>
            <button class="btn btn-secondary" data-action="importar-ventas" data-i18n="ventas:btn_import">üì§ Importar Ventas
              TPV</button>
          </div>

          <div class="card">
            <h3 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
              <span
                style="background: linear-gradient(135deg, #10B981 0%, #059669 100%); padding: 8px 12px; border-radius: 10px; font-size: 1.2rem;">üßæ</span>
              <span data-i18n="ventas:btn_register">Registrar Venta</span>
            </h3>
            <form id="form-venta"
              style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 20px; align-items: end;">
              <!-- Columna 1: Plato -->
              <div class="form-group" style="margin: 0;">
                <label
                  style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                  <span style="font-size: 1.1rem;">üçΩÔ∏è</span> <span data-i18n="ventas:form_dish">Plato</span>
                </label>
                <select id="venta-receta" required onchange="window.cargarVariantesVenta(this.value)"
                  style="width: 100%; padding: 12px 16px; border: 2px solid #E5E7EB; border-radius: 12px; font-size: 1rem; background: #F9FAFB; transition: all 0.2s; cursor: pointer;"
                  onfocus="this.style.borderColor='#F97316'; this.style.boxShadow='0 0 0 3px rgba(249,115,22,0.1)';"
                  onblur="this.style.borderColor='#E5E7EB'; this.style.boxShadow='none';"></select>
              </div>

              <!-- Columna 2: Cantidad -->
              <div class="form-group" style="margin: 0;">
                <label
                  style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                  <span style="font-size: 1.1rem;">üî¢</span> <span data-i18n="ventas:form_quantity">Cantidad</span>
                </label>
                <input type="number" id="venta-cantidad" min="1" value="1" required
                  style="width: 100%; padding: 12px 16px; border: 2px solid #E5E7EB; border-radius: 12px; font-size: 1rem; background: #F9FAFB; transition: all 0.2s; text-align: center; font-weight: 600;"
                  onfocus="this.style.borderColor='#F97316'; this.style.boxShadow='0 0 0 3px rgba(249,115,22,0.1)';"
                  onblur="this.style.borderColor='#E5E7EB'; this.style.boxShadow='none';">
              </div>

              <!-- Columna 3: Bot√≥n -->
              <button type="submit" class="btn btn-success"
                style="padding: 12px 24px; font-size: 1rem; font-weight: 600; border-radius: 12px; display: flex; align-items: center; gap: 8px; white-space: nowrap;">
                <span data-i18n="ventas:form_register_btn">‚úÖ Registrar</span>
              </button>

              <!-- Selector de variante (solo para bebidas) - ocupa toda la fila -->
              <div id="venta-variante-container" style="display: none; grid-column: 1 / -1;">
                <label
                  style="display: flex; align-items: center; gap: 8px; font-weight: 600; color: #374151; margin-bottom: 8px;">
                  <span style="font-size: 1.1rem;">üç∑</span> <span data-i18n="ventas:form_variant_label">Formato de venta</span>
                </label>
                <select id="venta-variante"
                  style="width: 100%; padding: 12px 16px; border: 2px solid #E5E7EB; border-radius: 12px; font-size: 1rem; background: #F9FAFB;">
                  <option value="" data-i18n="ventas:no_variant">Sin variante (unidad completa)</option>
                </select>
              </div>
            </form>
          </div>

          <div class="card" style="margin-bottom: 20px;">
            <h3 data-i18n="ventas:filter_date">üìÖ Filtrar por Fecha</h3>
            <div style="display: flex; gap: 15px; align-items: end;">
              <div class="form-group" style="flex: 1;">
                <label data-i18n="ventas:filter_from">Desde:</label>
                <input type="date" id="ventas-fecha-desde" class="form-control">
              </div>
              <div class="form-group" style="flex: 1;">
                <label data-i18n="ventas:filter_to">Hasta:</label>
                <input type="date" id="ventas-fecha-hasta" class="form-control">
              </div>
              <button class="btn btn-primary" data-action="filtrar-ventas" data-i18n="ventas:btn_filter_action">üîç Filtrar</button>
              <button class="btn btn-secondary" data-action="limpiar-filtros-ventas" data-i18n="ventas:btn_clear_filters">üîÑ
                Limpiar</button>
            </div>
          </div>

          <div class="card">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
              <h3 style="margin: 0;" data-i18n="ventas:history_title">üìä Hist√≥rico de Ventas</h3>
              <button class="btn btn-secondary" data-action="exportar-ventas" data-i18n="ventas:btn_export">üì• Exportar Excel</button>
            </div>
            <div id="tabla-ventas"></div>
          </div>
        </div>

        <!-- TAB: DIARIO (Tracking de Costes/Ventas por D√≠a) -->
        <div id="tab-diario" class="tab-content">
          <div class="top-bar">
            <div>
              <h2 data-i18n="balance:diario_title">üìà Control Diario</h2>
              <p data-i18n="balance:diario_description">Tracking de compras y ventas por d√≠a - Vista tipo Excel</p>
            </div>
            <div style="display: flex; gap: 10px; align-items: center;">
              <select id="diario-mes" class="form-control"
                style="padding: 10px; border-radius: 8px; border: 1px solid #ddd;">
                <option value="1" data-i18n="dashboard:month_jan">Enero</option>
                <option value="2" data-i18n="dashboard:month_feb">Febrero</option>
                <option value="3" data-i18n="dashboard:month_mar">Marzo</option>
                <option value="4" data-i18n="dashboard:month_apr">Abril</option>
                <option value="5" data-i18n="dashboard:month_may">Mayo</option>
                <option value="6" data-i18n="dashboard:month_jun">Junio</option>
                <option value="7" data-i18n="dashboard:month_jul">Julio</option>
                <option value="8" data-i18n="dashboard:month_aug">Agosto</option>
                <option value="9" data-i18n="dashboard:month_sep">Septiembre</option>
                <option value="10" data-i18n="dashboard:month_oct">Octubre</option>
                <option value="11" data-i18n="dashboard:month_nov">Noviembre</option>
                <option value="12" data-i18n="dashboard:month_dec">Diciembre</option>
              </select>
              <select id="diario-ano" class="form-control"
                style="padding: 10px; border-radius: 8px; border: 1px solid #ddd;">
                <option value="2024">2024</option>
                <option value="2025" selected>2025</option>
                <option value="2026">2026</option>
              </select>
              <button class="btn btn-primary" data-action="cargar-resumen-mensual" data-i18n="balance:diario_btn_load">üîÑ Cargar</button>
              <button class="btn btn-secondary" data-action="exportar-diario-excel" data-i18n="balance:diario_btn_export">üì• Exportar Excel</button>
            </div>
          </div>

          <!-- Selector de Vista -->
          <div style="display: flex; gap: 10px; margin-bottom: 20px;">
            <button id="btn-vista-compras" class="btn btn-primary" data-action="vista-diario" data-vista="compras" data-i18n="balance:diario_view_purchases">üõí
              Compras (Costes)</button>
            <button id="btn-vista-ventas" class="btn btn-secondary" data-action="vista-diario" data-vista="ventas" data-i18n="balance:diario_view_sales">üí∞
              Ventas (Ingresos)</button>
            <button id="btn-vista-proveedores" class="btn btn-secondary" data-action="vista-diario"
              data-vista="proveedores" data-i18n="balance:diario_view_suppliers">üì¶
              Por Proveedor</button>
            <button id="btn-vista-combinada" class="btn btn-secondary" data-action="vista-diario"
              data-vista="combinada" data-i18n="balance:diario_view_combined">üìä
              P&L Diario</button>
          </div>
          <!-- Tablas Diarias (FUERA del grid para que ocupen 100% ancho) -->
          <div style="margin-top: 30px;">
            <!-- Vista Compras -->
            <div id="vista-compras" class="diario-vista" style="display: block;">
              <h3 style="margin-bottom: 15px;" data-i18n="balance:diario_purchase_title">üõí Precio de Compra por Ingrediente / D√≠a</h3>
              <div id="tabla-compras-diarias" style="overflow-x: auto; width: 100%; max-width: 100%;">
                <p class="empty-state" data-i18n="balance:diario_empty">Selecciona un mes y haz clic en "Cargar" para ver los datos</p>
              </div>
            </div>

            <!-- Vista Ventas -->
            <div id="vista-ventas" class="diario-vista" style="display: none;">
              <h3 style="margin-bottom: 15px;" data-i18n="balance:diario_sales_title">üí∞ Ventas por Receta / D√≠a</h3>
              <div id="tabla-ventas-diarias" style="overflow-x: auto; width: 100%; max-width: 100%;">
                <p class="empty-state" data-i18n="balance:diario_empty">Selecciona un mes y haz clic en "Cargar" para ver los datos</p>
              </div>
            </div>

            <!-- Vista Combinada (P&L) -->
            <div id="vista-combinada" class="diario-vista" style="display: none;">
              <div id="tabla-pl-diario" style="overflow-x: auto; width: 100%; max-width: 100%;">
                <p class="empty-state" data-i18n="balance:diario_empty">Selecciona un mes y haz clic en "Cargar" para ver los datos</p>
              </div>
            </div>

            <!-- Vista Por Proveedor -->
            <div id="vista-proveedores" class="diario-vista" style="display: none;">
              <div id="tabla-proveedores-diarios" style="overflow-x: auto; width: 100%; max-width: 100%;">
                <p class="empty-state" data-i18n="balance:diario_empty">Selecciona un mes y haz clic en "Cargar" para ver los datos</p>
              </div>
            </div>
          </div>

          <!-- üí∞ BENEFICIO NETO POR D√çA (MOVIDA ABAJO) -->
          <div
            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; padding: 20px; margin-bottom: 20px; margin-top: 20px; box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);">
            <h3
              style="margin: 0 0 16px 0; font-size: 16px; color: white; display: flex; align-items: center; gap: 8px;">
              <span data-i18n="balance:diario_net_profit">üí∞ Beneficio Neto por D√≠a</span>
            </h3>
            <div id="beneficio-neto-diario-lista"
              style="max-height: 300px; overflow-y: auto; background: white; border-radius: 12px; padding: 12px;">
              <p style="color: #64748B; margin: 0; text-align: center; padding: 20px;" data-i18n="balance:diario_net_profit_empty">Carga un mes para ver los datos
              </p>
            </div>
          </div>



          <!-- üí∞ GASTOS FIJOS MENSUALES -->
          <div
            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 25px; border-radius: 16px; margin-bottom: 25px; box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);">
            <h3 style="margin: 0 0 20px 0; color: white; font-size: 20px; font-weight: 700;" data-i18n="balance:diario_fixed_expenses">üí∞ Gastos Fijos Mensuales
            </h3>
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px;">
              <!-- Alquiler -->
              <div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                  <label style="font-weight: 600; color: rgba(255,255,255,0.9); font-size: 14px;" data-i18n="balance:diario_rent">Alquiler Local</label>
                  <span id="gf-alquiler-valor" style="font-weight: 700; color: white; font-size: 16px;">0‚Ç¨</span>
                </div>
                <input type="range" id="gf-alquiler" min="0" max="10000" step="100" value="0"
                  style="width: 100%; height: 8px; border-radius: 10px; background: rgba(255,255,255,0.3); outline: none; cursor: pointer;"
                  oninput="document.getElementById('gf-alquiler-valor').textContent = this.value + '‚Ç¨'; window.guardarGastoFinanzas('alquiler', 'gf-alquiler');">
              </div>

              <!-- Personal -->
              <div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                  <label style="font-weight: 600; color: rgba(255,255,255,0.9); font-size: 14px;" data-i18n="balance:diario_payroll">Personal
                    (N√≥minas)</label>
                  <span id="gf-personal-valor" style="font-weight: 700; color: white; font-size: 16px;">0‚Ç¨</span>
                </div>
                <input type="range" id="gf-personal" min="0" max="30000" step="100" value="0"
                  style="width: 100%; height: 8px; border-radius: 10px; background: rgba(255,255,255,0.3); outline: none; cursor: pointer;"
                  oninput="document.getElementById('gf-personal-valor').textContent = this.value + '‚Ç¨'; window.guardarGastoFinanzas('personal', 'gf-personal');">
              </div>

              <!-- Suministros -->
              <div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                  <label style="font-weight: 600; color: rgba(255,255,255,0.9); font-size: 14px;" data-i18n="balance:diario_utilities">Suministros</label>
                  <span id="gf-suministros-valor" style="font-weight: 700; color: white; font-size: 16px;">0‚Ç¨</span>
                </div>
                <input type="range" id="gf-suministros" min="0" max="5000" step="50" value="0"
                  style="width: 100%; height: 8px; border-radius: 10px; background: rgba(255,255,255,0.3); outline: none; cursor: pointer;"
                  oninput="document.getElementById('gf-suministros-valor').textContent = this.value + '‚Ç¨'; window.guardarGastoFinanzas('suministros', 'gf-suministros');">
              </div>

              <!-- Otros -->
              <div>
                <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                  <label style="font-weight: 600; color: rgba(255,255,255,0.9); font-size: 14px;" data-i18n="balance:diario_other_expenses">Otros Gastos</label>
                  <span id="gf-otros-valor" style="font-weight: 700; color: white; font-size: 16px;">0‚Ç¨</span>
                </div>
                <input type="range" id="gf-otros" min="0" max="5000" step="50" value="0"
                  style="width: 100%; height: 8px; border-radius: 10px; background: rgba(255,255,255,0.3); outline: none; cursor: pointer;"
                  oninput="document.getElementById('gf-otros-valor').textContent = this.value + '‚Ç¨'; window.guardarGastoFinanzas('otros', 'gf-otros');">
              </div>
            </div>
            <div
              style="margin-top: 15px; padding: 12px; background: rgba(255,255,255,0.2); border-radius: 10px; text-align: center;">
              <span style="color: white; font-size: 13px; font-weight: 500;" data-i18n="balance:diario_autosave_hint">‚úì Se guardan autom√°ticamente y aparecen en
                el
                P&L Diario</span>
            </div>
          </div>

          <!-- Resumen R√°pido -->
          <div class="stats-grid" id="diario-resumen">
            <div class="stat-card">
              <h3 data-i18n="balance:diario_total_purchases">Total Compras Mes</h3>
              <div class="value" id="diario-total-compras">0.00 ‚Ç¨</div>
            </div>
            <div class="stat-card green">
              <h3 data-i18n="balance:diario_total_sales">Total Ventas Mes</h3>
              <div class="value" id="diario-total-ventas">0.00 ‚Ç¨</div>
            </div>
            <div class="stat-card blue">
              <h3 data-i18n="balance:diario_gross_profit">Beneficio Bruto</h3>
              <div class="value" id="diario-beneficio">0.00 ‚Ç¨</div>
            </div>
            <div class="stat-card orange">
              <h3 data-i18n="balance:diario_food_cost">Food Cost</h3>
              <div class="value" id="diario-food-cost">0.0%</div>
            </div>
            <div class="stat-card purple"
              style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
              <h3 style="color: rgba(255,255,255,0.9);" data-i18n="balance:diario_fixed_total">üí∞ Gastos Fijos Totales</h3>
              <div class="value" id="diario-gastos-fijos-total" style="color: white;">0.00 ‚Ç¨</div>
            </div>
          </div>
        </div>

        <!-- TAB: HORARIOS -->
        <div id="tab-horarios" class="tab-content">
          <div class="top-bar"
            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 16px; margin-bottom: 24px;">
            <div>
              <h2 style="color: white; margin-bottom: 8px; display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 32px;">üë•</span>
                MindLoop Staff Scheduler
              </h2>
              <p style="color: rgba(255,255,255,0.9); font-size: 15px;" data-i18n="horarios:staff_scheduler_subtitle">Gesti√≥n inteligente de horarios y plantilla</p>
            </div>
            <div style="display: flex; gap: 12px; align-items: center;">
              <button class="btn" data-action="generar-horario-ia"
                style="background: rgba(255,255,255,0.2); backdrop-filter: blur(10px); border: 2px solid rgba(255,255,255,0.3); color: white; font-weight: 600; padding: 12px 24px; display: flex; align-items: center; gap: 8px; transition: all 0.3s;">
                <span style="font-size: 18px;">‚ö°</span>
                <span data-i18n="horarios:btn_generate_ai">Generar Horario IA</span>
              </button>
              <button class="btn btn-primary" data-action="nuevo-empleado"
                style="background: white; color: #667eea; font-weight: 600; padding: 12px 24px; box-shadow: 0 4px 12px rgba(0,0,0,0.15);">
                <span style="font-size: 16px;">‚ûï</span> <span data-i18n="horarios:btn_new_employee">Nuevo Empleado</span>
              </button>
            </div>
          </div>

          <!-- Lista de Empleados -->
          <div class="card"
            style="margin-bottom: 24px; border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
            <div
              style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); padding: 20px; border-bottom: 2px solid #e2e8f0;">
              <h3 style="color: #1e293b; margin: 0; font-size: 18px; font-weight: 700;">
                <span style="font-size: 20px;">üë®‚Äçüíº</span> <span data-i18n="horarios:active_staff">Plantilla Activa</span>
              </h3>
            </div>
            <div id="lista-empleados" style="padding: 20px;">
              <div style="text-align: center; padding: 40px; color: #94a3b8;">
                <div style="font-size: 48px; margin-bottom: 16px;">üë•</div>
                <p style="font-size: 16px;" data-i18n="horarios:empty_no_employees">No hay empleados todav√≠a</p>
                <p style="font-size: 14px; color: #cbd5e1;" data-i18n="horarios:empty_add_first">A√±ade tu primer empleado para empezar</p>
              </div>
            </div>
          </div>

          <!-- Grid de Horarios -->
          <div class="card" style="border-radius: 16px; overflow: hidden; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
            <div
              style="background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); padding: 20px; border-bottom: 2px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center;">
              <h3 style="color: #1e293b; margin: 0; font-size: 18px; font-weight: 700;">
                <span style="font-size: 20px;">üìÖ</span> <span data-i18n="horarios:weekly_schedule">Horario Semanal</span>
              </h3>
              <div style="display: flex; gap: 12px; align-items: center;">
                <button class="btn btn-icon" data-action="semana-anterior"
                  style="background: white; border: 2px solid #e2e8f0; color: #64748b; padding: 8px 16px; border-radius: 8px; font-weight: 600; transition: all 0.2s;">
                  <span data-i18n="horarios:btn_previous">‚óÄ Anterior</span>
                </button>
                <div id="semana-actual" data-i18n="common:loading"
                  style="padding: 8px 20px; background: white; border-radius: 8px; border: 2px solid #e2e8f0; font-weight: 600; color: #1e293b; min-width: 200px; text-align: center;">
                  Cargando...
                </div>
                <button class="btn btn-icon" data-action="semana-siguiente"
                  style="background: white; border: 2px solid #e2e8f0; color: #64748b; padding: 8px 16px; border-radius: 8px; font-weight: 600; transition: all 0.2s;">
                  <span data-i18n="horarios:btn_next">Siguiente ‚ñ∂</span>
                </button>
                <button class="btn" data-action="copiar-semana"
                  style="background: #667eea; color: white; border: none; padding: 8px 16px; border-radius: 8px; font-weight: 600; margin-left: 12px;">
                  <span data-i18n="horarios:btn_copy_week_short">üìã Copiar Semana</span>
                </button>
                <button class="btn" onclick="window.descargarHorarioMensual?.()"
                  style="background: #10b981; color: white; border: none; padding: 8px 16px; border-radius: 8px; font-weight: 600; margin-left: 8px;">
                  <span data-i18n="horarios:btn_download_month">üì• Descargar Mes</span>
                </button>
              </div>
            </div>
            <div id="grid-horarios" style="padding: 20px; overflow-x: auto;">
              <div style="text-align: center; padding: 60px; color: #94a3b8;">
                <div style="font-size: 48px; margin-bottom: 16px;">üìÖ</div>
                <p style="font-size: 16px;" data-i18n="horarios:empty_add_for_grid">A√±ade empleados para ver el horario</p>
              </div>
            </div>
          </div>
        </div>

        <!-- TAB: INTELIGENCIA -->
        <div id="tab-inteligencia" class="tab-content">
          <div id="content-inteligencia">
            <div style="text-align: center; padding: 60px; color: #64748b;">
              <div style="font-size: 48px;">‚è≥</div>
              <p data-i18n="horarios:inteligencia_loading">Cargando Inteligencia...</p>
            </div>
          </div>
        </div>

        <!-- TAB: CONFIGURACI√ìN -->
        <div id="tab-configuracion" class="tab-content">
          <div class="top-bar">
            <div>
              <h2 data-i18n="settings:config_title">‚öôÔ∏è Configuraci√≥n & Equipo</h2>
              <p data-i18n="settings:config_description">Gestiona los accesos y datos de tu negocio</p>
            </div>
            <div style="display: flex; gap: 10px;">
              <button class="btn btn-secondary" onclick="window.resetOnboarding(); window.startTour();"
                style="background: linear-gradient(135deg, #667eea, #764ba2); color: white; border: none;">
                <span data-i18n="settings:btn_restart_tour">üéØ Reiniciar Tour</span>
              </button>
              <button class="btn btn-secondary" data-action="abrir-manual-formulas" data-i18n="settings:btn_download_dossier">üìò Descargar/Imprimir
                Dossier</button>
            </div>
          </div>

          <div class="dashboard-grid" style="grid-template-columns: 1fr; gap: 24px;">

            <!-- Tarjeta: Gesti√≥n de Equipo -->
            <div class="card"
              style="background:white; padding:20px; border-radius:16px; box-shadow:0 2px 12px rgba(0,0,0,0.08);">
              <div class="card-header"
                style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 data-i18n="settings:section_team">üë• Mi Equipo</h3>
                <button class="btn btn-primary" data-action="mostrar-modal-invitar" data-i18n="equipo:btn_invite">+ Invitar Usuario</button>
              </div>
              <div class="table-container">
                <table style="width:100%; border-collapse:collapse;">
                  <thead>
                    <tr style="border-bottom:2px solid #eee;">
                      <th style="text-align:left; padding:10px;" data-i18n="common:label_name">Nombre</th>
                      <th style="text-align:left; padding:10px;" data-i18n="common:label_email">Email</th>
                      <th style="text-align:left; padding:10px;" data-i18n="equipo:col_role">Rol</th>
                      <th style="text-align:left; padding:10px;" data-i18n="equipo:col_join_date">Fecha Alta</th>
                      <th style="text-align:right; padding:10px;" data-i18n="common:label_actions">Acciones</th>
                    </tr>
                  </thead>
                  <tbody id="lista-equipo-body">
                    <!-- Se llena con JS -->
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Placeholder Datos Restaurante -->
            <div class="card"
              style="background:white; padding:20px; border-radius:16px; box-shadow:0 2px 12px rgba(0,0,0,0.08);">
              <h3 data-i18n="settings:section_restaurant_data">üè¢ Datos del Restaurante</h3>
              <div style="margin-top:10px; color:#666;">
                <p><strong data-i18n="settings:restaurant_name_label">Nombre:</strong> <span id="config-restaurante-nombre">Cargando...</span></p>
                <p style="font-size:0.9em; margin-top:5px;"><span data-i18n="settings:restaurant_id_label">ID Restaurante:</span> <span id="config-restaurante-id">...</span>
                </p>
              </div>
            </div>

            <!-- Tarjeta: Integraciones -->
            <div class="card"
              style="background:white; padding:20px; border-radius:16px; box-shadow:0 2px 12px rgba(0,0,0,0.08);">
              <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
                <div>
                  <h3 style="margin:0;" data-i18n="settings:section_integrations">üîó Integraciones Activas</h3>
                  <p style="font-size:0.85rem; color:#64748b; margin:4px 0 0 0;" data-i18n="settings:integrations_subtitle">Conexiones automatizadas con n8n</p>
                </div>
                <button onclick="window.checkAllIntegrations()"
                  style="background:linear-gradient(135deg, #667eea 0%, #764ba2 100%); color:white; border:none; padding:8px 16px; border-radius:8px; font-size:0.8rem; font-weight:600; cursor:pointer; transition:all 0.3s;">
                  <span data-i18n="settings:btn_verify_status">üîÑ Verificar Estado</span>
                </button>
              </div>
              <div style="display:flex; flex-direction:column; gap:12px;">

                <!-- n8n Webhooks -->
                <div id="integration-n8n"
                  style="display:flex; justify-content:space-between; align-items:center; padding:14px; background:linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius:12px; border:1px solid #86efac;">
                  <div style="display:flex; align-items:center; gap:12px;">
                    <span style="font-size:1.5rem;">üîÑ</span>
                    <div>
                      <strong style="color:#1e293b;" data-i18n="settings:integration_n8n">n8n Webhooks</strong>
                      <p style="font-size:0.8rem; color:#16a34a; margin:2px 0 0 0;" data-i18n="settings:integration_n8n_desc">Automatizaci√≥n de flujos de trabajo
                      </p>
                    </div>
                  </div>
                  <span id="status-n8n"
                    style="font-size:0.75rem; padding:6px 12px; border-radius:20px; background:linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color:white; font-weight:600;" data-i18n="settings:integration_connected">‚úì
                    Conectado</span>
                </div>

                <!-- Google Sheets - Pedidos/Albaranes -->
                <div id="integration-sheets"
                  style="display:flex; justify-content:space-between; align-items:center; padding:14px; background:linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius:12px; border:1px solid #86efac;">
                  <div style="display:flex; align-items:center; gap:12px;">
                    <span style="font-size:1.5rem;">üìä</span>
                    <div>
                      <strong style="color:#1e293b;" data-i18n="settings:integration_sheets">Google Sheets</strong>
                      <p style="font-size:0.8rem; color:#16a34a; margin:2px 0 0 0;" data-i18n="settings:integration_sheets_desc">üì∑ Albaranes ‚Üí Foto ‚Üí n8n ‚Üí Pedidos
                      </p>
                    </div>
                  </div>
                  <span id="status-sheets"
                    style="font-size:0.75rem; padding:6px 12px; border-radius:20px; background:linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color:white; font-weight:600;" data-i18n="settings:integration_connected">‚úì
                    Conectado</span>
                </div>

                <!-- Email Ventas Cuiner -->
                <div id="integration-cuiner"
                  style="display:flex; justify-content:space-between; align-items:center; padding:14px; background:linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%); border-radius:12px; border:1px solid #86efac;">
                  <div style="display:flex; align-items:center; gap:12px;">
                    <span style="font-size:1.5rem;">üìß</span>
                    <div>
                      <strong style="color:#1e293b;" data-i18n="settings:integration_cuiner">Email Ventas (Cuiner)</strong>
                      <p style="font-size:0.8rem; color:#16a34a; margin:2px 0 0 0;" data-i18n="settings:integration_cuiner_desc">üì¨ Email diario ‚Üí n8n ‚Üí Ventas del
                        d√≠a
                      </p>
                    </div>
                  </div>
                  <span id="status-cuiner"
                    style="font-size:0.75rem; padding:6px 12px; border-radius:20px; background:linear-gradient(135deg, #22c55e 0%, #16a34a 100%); color:white; font-weight:600;" data-i18n="settings:integration_connected">‚úì
                    Conectado</span>
                </div>

                <!-- Info -->
                <div
                  style="margin-top:8px; padding:12px 14px; background:linear-gradient(135deg, #eff6ff 0%, #dbeafe 100%); border-radius:10px; border:1px solid #93c5fd;">
                  <p style="font-size:0.8rem; color:#1e40af; margin:0;">
                    <span data-i18n-html="settings:integrations_hint">üí° <strong>Flujo automatizado:</strong> Los albaranes se procesan con IA desde fotos, y las ventas
                    de
                    Cuiner llegan autom√°ticamente cada d√≠a por email.</span>
                  </p>
                </div>

              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- TAB: HORARIOS (AI Staff Scheduler) -->
      <div id="tab-horarios" class="tab-content">
        <div class="top-bar" style="display: flex; justify-content: space-between; align-items: center;">
          <div>
            <h2 style="display: flex; align-items: center; gap: 10px;">
              <span
                style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 8px; border-radius: 10px;">ü§ñ</span>
              MindLoop Staff Scheduler
            </h2>
            <p style="opacity: 0.7;" data-i18n="horarios:staff_scheduler_subtitle">Generador inteligente de horarios con IA</p>
          </div>
          <div style="display: flex; gap: 10px;">
            <button id="btn-descargar-horario" class="btn btn-secondary" onclick="window.descargarHorarioMensual?.()"
              style="background: #10b981; border: none; padding: 12px 20px; font-weight: 600; color: white; border-radius: 8px;">
              <span data-i18n="horarios:btn_download_month">üì• Descargar Mes</span>
            </button>
            <button id="btn-generar-horario" class="btn btn-primary" onclick="window.generarHorarioIA?.()"
              style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; padding: 12px 20px; font-weight: 600;">
              <span data-i18n="horarios:btn_generate_ai">‚ö° Generar Horario IA</span>
            </button>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 300px 1fr; gap: 20px; margin-top: 20px;">

          <!-- Panel izquierdo: Equipo -->
          <div class="card" style="padding: 0; overflow: hidden;">
            <div
              style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;">
              <h3 style="margin: 0; font-size: 1rem;" data-i18n="settings:section_team">üë• Equipo</h3>
              <button id="btn-add-empleado" onclick="window.mostrarModalEmpleado?.()"
                style="background: rgba(255,255,255,0.2); border: none; color: white; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.9rem;">
                <span data-i18n="common:btn_new">+ Nuevo</span>
              </button>
            </div>
            <div id="lista-empleados" style="padding: 15px; max-height: 400px; overflow-y: auto;">
              <div style="text-align: center; padding: 30px; color: #64748B;">
                <div style="font-size: 2rem; margin-bottom: 10px;">üë§</div>
                <p style="font-size: 0.85rem;" data-i18n="horarios:empty_no_employees_team">Sin empleados</p>
                <p style="font-size: 0.75rem; opacity: 0.7;" data-i18n="horarios:empty_click_new">Haz clic en "+ Nuevo" para a√±adir</p>
              </div>
            </div>
          </div>

          <!-- Panel derecho: Calendario semanal -->
          <div class="card" style="padding: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <div style="display: flex; align-items: center; gap: 12px;">
                <button id="btn-semana-prev" onclick="window.semanaAnteriorUI?.()"
                  style="background: #f1f5f9; border: none; padding: 10px 14px; border-radius: 8px; cursor: pointer; font-size: 1rem;">‚óÄ</button>
                <h3 id="titulo-semana" style="margin: 0; font-size: 1.1rem; font-weight: 600;">Enero 2026</h3>
                <button id="btn-semana-next" onclick="window.semanaSiguienteUI?.()"
                  style="background: #f1f5f9; border: none; padding: 10px 14px; border-radius: 8px; cursor: pointer; font-size: 1rem;">‚ñ∂</button>
              </div>
              <button id="btn-copiar-semana" onclick="window.copiarSemanaUI?.()"
                style="background: #f1f5f9; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 0.85rem;">
                <span data-i18n="horarios:btn_copy_prev_week">üìã Copiar semana anterior</span>
              </button>
              <button id="btn-descargar-mes" onclick="window.descargarHorarioMensual?.()"
                style="background: #10b981; border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; color: white; font-weight: 600;">
                <span data-i18n="horarios:btn_download_month">üì• Descargar Mes</span>
              </button>
            </div>

            <div id="grid-horarios" style="overflow-x: auto;">
              <!-- Aqu√≠ se renderiza la cuadr√≠cula -->
              <table style="width: 100%; border-collapse: separate; border-spacing: 4px; min-width: 600px;">
                <thead>
                  <tr>
                    <th style="padding: 12px; text-align: left; font-weight: 600; color: #64748B; font-size: 0.8rem;" data-i18n="horarios:grid_header_employee_upper">
                      EMPLEADO</th>
                    <th style="padding: 12px; text-align: center; font-weight: 600; color: #64748B; font-size: 0.8rem;" data-i18n="horarios:days_short_mon">
                      LUN
                    </th>
                    <th style="padding: 12px; text-align: center; font-weight: 600; color: #64748B; font-size: 0.8rem;" data-i18n="horarios:days_short_tue">
                      MAR
                    </th>
                    <th style="padding: 12px; text-align: center; font-weight: 600; color: #64748B; font-size: 0.8rem;" data-i18n="horarios:days_short_wed">
                      MI√â
                    </th>
                    <th style="padding: 12px; text-align: center; font-weight: 600; color: #64748B; font-size: 0.8rem;" data-i18n="horarios:days_short_thu">
                      JUE
                    </th>
                    <th style="padding: 12px; text-align: center; font-weight: 600; color: #64748B; font-size: 0.8rem;" data-i18n="horarios:days_short_fri">
                      VIE
                    </th>
                    <th style="padding: 12px; text-align: center; font-weight: 600; color: #64748B; font-size: 0.8rem;" data-i18n="horarios:days_short_sat">
                      S√ÅB
                    </th>
                    <th style="padding: 12px; text-align: center; font-weight: 600; color: #64748B; font-size: 0.8rem;" data-i18n="horarios:days_short_sun">
                      DOM
                    </th>
                  </tr>
                </thead>
                <tbody id="tbody-horarios">
                  <tr>
                    <td colspan="8" style="padding: 50px; text-align: center; color: #94A3B8;">
                      <div style="font-size: 2.5rem; margin-bottom: 15px;">üìÖ</div>
                      <p style="font-weight: 500;" data-i18n="horarios:empty_add_for_schedule">A√±ade empleados para empezar</p>
                      <p style="font-size: 0.8rem; opacity: 0.7; margin-top: 5px;" data-i18n="horarios:empty_schedule_ai_hint">El horario se generar√°
                        autom√°ticamente
                        con IA</p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- Stats footer -->
            <div
              style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-top: 20px; padding-top: 20px; border-top: 1px solid #e2e8f0;">
              <div style="text-align: center;">
                <div id="stat-empleados"
                  style="font-size: 1.8rem; font-weight: 700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                  0</div>
                <div style="font-size: 0.75rem; color: #64748B; text-transform: uppercase; letter-spacing: 0.5px;" data-i18n="horarios:stat_employees">
                  Empleados
                </div>
              </div>
              <div style="text-align: center;">
                <div id="stat-turnos" style="font-size: 1.8rem; font-weight: 700; color: #059669;">0</div>
                <div style="font-size: 0.75rem; color: #64748B; text-transform: uppercase; letter-spacing: 0.5px;" data-i18n="horarios:stat_shifts">
                  Turnos
                </div>
              </div>
              <div style="text-align: center;">
                <div id="stat-horas" style="font-size: 1.8rem; font-weight: 700; color: #0EA5E9;">0h</div>
                <div style="font-size: 0.75rem; color: #64748B; text-transform: uppercase; letter-spacing: 0.5px;" data-i18n="horarios:stat_hours">Horas
                </div>
              </div>
              <div style="text-align: center;">
                <div id="stat-coste" style="font-size: 1.8rem; font-weight: 700; color: #DC2626;">0‚Ç¨</div>
                <div style="font-size: 0.75rem; color: #64748B; text-transform: uppercase; letter-spacing: 0.5px;" data-i18n="horarios:stat_cost">Coste
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>



      <!-- MODAL INVITAR EQUIPO -->
      <div id="modal-invitar-equipo" class="modal">
        <div class="modal-content" style="max-width:500px">
          <span class="close" data-action="cerrar-modal-invitar">&times;</span>
          <h2 data-i18n="equipo:invite_modal_title">Invitar Nuevo Usuario</h2>
          <div style="margin-top:20px;">
            <div class="form-group" style="margin-bottom:15px;">
              <label style="display:block; margin-bottom:5px; font-weight:bold;" data-i18n="equipo:invite_name_label">Nombre Completo</label>
              <input type="text" id="team-nombre" class="form-control" placeholder="Ej. Juan Cocinero" data-i18n-placeholder="equipo:invite_name_placeholder"
                style="width:100%; padding:10px; border-radius:8px; border:1px solid #ddd;">
            </div>
            <div class="form-group" style="margin-bottom:15px;">
              <label style="display:block; margin-bottom:5px; font-weight:bold;" data-i18n="equipo:invite_email_corporate">Email Corporativo</label>
              <input type="email" id="team-email" class="form-control" placeholder="usuario@restaurante.com" data-i18n-placeholder="equipo:invite_email_placeholder"
                style="width:100%; padding:10px; border-radius:8px; border:1px solid #ddd;">
            </div>
            <div class="form-group" style="margin-bottom:15px;">
              <label style="display:block; margin-bottom:5px; font-weight:bold;" data-i18n="equipo:invite_password_label">Contrase√±a Inicial</label>
              <input type="password" id="team-password" class="form-control" placeholder="******"
                style="width:100%; padding:10px; border-radius:8px; border:1px solid #ddd;">
            </div>
            <div class="form-group" style="margin-bottom:20px;">
              <label style="display:block; margin-bottom:5px; font-weight:bold;">Rol</label>
              <select id="team-rol" style="width:100%; padding:10px; border-radius:8px; border:1px solid #ddd;">
                <option value="usuario" data-i18n="equipo:role_user_standard">Usuario (Est√°ndar)</option>
                <option value="admin" data-i18n="equipo:role_admin_full">Administrador (Acceso Total)</option>
              </select>
            </div>
            <button class="btn btn-primary" style="width:100%" data-action="invitar-usuario-equipo" data-i18n="equipo:btn_send_invitation">Enviar
              Invitaci√≥n</button>
          </div>
        </div>
      </div>

      <!-- Modales (simplificados) -->
      <div id="modal-producir" class="modal">
        <div class="modal-content">
          <h3 data-i18n="recetas:produce_title">Producir platos</h3>
          <p style="margin-bottom: 20px;" data-i18n-html="recetas:produce_how_many_html">¬øCu√°ntas unidades de <strong id="modal-plato-nombre"></strong>?</p>
          <div class="form-group">
            <label data-i18n="common:label_quantity">Cantidad</label>
            <input type="number" id="modal-cantidad" min="1" value="1" style="width:100%;padding:10px;"
              oninput="window.actualizarDetalleDescuento()">
          </div>
          <div style="margin-top: 20px; padding: 15px; background: #fef3c7; border-radius: 6px;">
            <strong data-i18n="recetas:produce_stock_deduction">‚ö†Ô∏è Descuento de stock:</strong>
            <div id="modal-descuento-detalle" style="margin-top: 10px;"></div>
          </div>
          <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button class="btn btn-secondary" data-action="cerrar-modal-producir" data-i18n="common:btn_cancel">Cancelar</button>
            <button class="btn btn-success" data-action="confirmar-produccion" data-i18n="recetas:produce_confirm">Confirmar</button>
          </div>
        </div>
      </div>

      <!-- Modal Empleado -->
      <div id="modal-empleado"
        style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; width: 100vw; height: 100vh; background-color: rgba(0,0,0,0.7); z-index: 99999; justify-content: center; align-items: center;">
        <div
          style="max-width: 500px; width: 90%; background: white; border-radius: 20px; overflow: hidden; padding: 24px; box-shadow: 0 25px 50px rgba(0,0,0,0.4); margin: auto;">
          <div
            style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 24px; margin: -24px -24px 24px -24px;">
            <h3 id="modal-empleado-titulo" style="color: white; margin: 0; font-size: 24px; font-weight: 700;">
              <span style="font-size: 28px;">üë§</span> <span data-i18n="horarios:employee_modal_title_new">Nuevo Empleado</span>
            </h3>
          </div>

          <div style="display: grid; gap: 20px;">
            <!-- Nombre -->
            <div class="form-group">
              <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1e293b; font-size: 14px;">
                <span data-i18n="horarios:employee_name_required">Nombre Completo *</span>
              </label>
              <input type="text" id="empleado-nombre" class="form-input" placeholder="Ej. Juan P√©rez"
                style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 15px; transition: all 0.2s;">
            </div>

            <!-- Fila: Color + Puesto -->
            <div style="display: grid; grid-template-columns: 120px 1fr; gap: 16px;">
              <!-- Color -->
              <div class="form-group">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1e293b; font-size: 14px;" data-i18n="horarios:employee_color">
                  Color
                </label>
                <input type="color" id="empleado-color" value="#667eea"
                  style="width: 100%; height: 48px; border: 2px solid #e2e8f0; border-radius: 10px; cursor: pointer;">
              </div>

              <!-- Puesto -->
              <div class="form-group">
                <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1e293b; font-size: 14px;" data-i18n="horarios:employee_position">
                  Puesto
                </label>
                <select id="empleado-puesto"
                  style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 15px; transition: all 0.2s;">
                  <option value="cocina" data-i18n="horarios:employee_position_kitchen">üë®‚Äçüç≥ Cocina</option>
                  <option value="sala" data-i18n="horarios:employee_position_dining">üçΩÔ∏è Sala</option>
                </select>
              </div>
            </div>

            <!-- Horas contrato -->
            <div class="form-group">
              <label style="display: block; margin-bottom: 8px; font-weight: 600; color: #1e293b; font-size: 14px;">
                <span data-i18n="horarios:employee_hours_contract">‚è±Ô∏è Horas contrato/semana</span>
              </label>
              <input type="number" id="empleado-horas-contrato" class="form-input" placeholder="40" min="0" max="168"
                style="width: 100%; padding: 12px; border: 2px solid #e2e8f0; border-radius: 10px; font-size: 15px; transition: all 0.2s;">
            </div>
          </div>

          <!-- D√≠as libres fijos -->
          <div class="form-group">
            <label style="display: block; margin-bottom: 12px; font-weight: 600; color: #1e293b; font-size: 14px;">
              <span data-i18n="horarios:employee_days_off">üìÖ D√≠as libres fijos</span>
            </label>
            <div style="display: flex; gap: 8px; flex-wrap: wrap;">
              <label style="flex: 1; min-width: 80px; cursor: pointer;">
                <input type="checkbox" id="libre-lunes" value="1" style="margin-right: 6px;">
                <span data-i18n="horarios:days_short_mon">Lun</span>
              </label>
              <label style="flex: 1; min-width: 80px; cursor: pointer;">
                <input type="checkbox" id="libre-martes" value="2" style="margin-right: 6px;">
                <span data-i18n="horarios:days_short_tue">Mar</span>
              </label>
              <label style="flex: 1; min-width: 80px; cursor: pointer;">
                <input type="checkbox" id="libre-miercoles" value="3" style="margin-right: 6px;">
                <span data-i18n="horarios:days_short_wed">Mi√©</span>
              </label>
              <label style="flex: 1; min-width: 80px; cursor: pointer;">
                <input type="checkbox" id="libre-jueves" value="4" style="margin-right: 6px;">
                <span data-i18n="horarios:days_short_thu">Jue</span>
              </label>
              <label style="flex: 1; min-width: 80px; cursor: pointer;">
                <input type="checkbox" id="libre-viernes" value="5" style="margin-right: 6px;">
                <span data-i18n="horarios:days_short_fri">Vie</span>
              </label>
              <label style="flex: 1; min-width: 80px; cursor: pointer;">
                <input type="checkbox" id="libre-sabado" value="6" style="margin-right: 6px;">
                <span data-i18n="horarios:days_short_sat">S√°b</span>
              </label>
              <label style="flex: 1; min-width: 80px; cursor: pointer;">
                <input type="checkbox" id="libre-domingo" value="0" style="margin-right: 6px;">
                <span data-i18n="horarios:days_short_sun">Dom</span>
              </label>
            </div>
          </div>

          <!-- Botones -->
          <div style="display: flex; gap: 12px; justify-content: flex-end; margin-top: 24px;">
            <button class="btn btn-secondary" data-action="cerrar-modal-empleado"
              style="padding: 12px 24px; border-radius: 10px; font-weight: 600; background: #e2e8f0; border: none; cursor: pointer;" data-i18n="common:btn_cancel">
              Cancelar
            </button>
            <button class="btn btn-primary" data-action="guardar-empleado"
              style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border: none; color: white; padding: 12px 32px; border-radius: 10px; font-weight: 600; box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4); cursor: pointer;">
              <span id="btn-guardar-empleado-text" data-i18n="horarios:btn_save">Guardar</span>
            </button>
          </div>
        </div>
      </div>

      <div id="modal-ver-proveedor" class="modal">
        <div class="modal-content">
          <h3 id="modal-proveedor-titulo"></h3>
          <div id="modal-proveedor-contenido"></div>
          <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button class="btn btn-secondary" data-action="cerrar-modal-proveedor" data-i18n="common:btn_close">Cerrar</button>
          </div>
        </div>
      </div>

      <!-- Modal gestionar proveedores de ingrediente -->
      <div id="modal-proveedores-ingrediente" class="modal">
        <div class="modal-content" style="max-width: 700px;">
          <h3 id="modal-proveedores-titulo" data-i18n="ingredientes:suppliers_modal_title">Proveedores del ingrediente</h3>

          <!-- Lista de proveedores asociados -->
          <div style="margin: 20px 0;">
            <h4 style="color: #64748B; font-size: 14px; margin-bottom: 12px;" data-i18n="ingredientes:suppliers_associated">PROVEEDORES ASOCIADOS</h4>
            <div id="lista-proveedores-asociados" style="max-height: 400px; overflow-y: auto;">
              <!-- Se renderiza din√°micamente -->
            </div>
          </div>

          <!-- Formulario para agregar nuevo proveedor -->
          <div style="background: #F8FAFC; padding: 20px; border-radius: 12px; margin-top: 20px;">
            <h4 style="color: #1E293B; font-size: 15px; margin-bottom: 16px;" data-i18n="ingredientes:suppliers_add_title">‚ûï Agregar proveedor</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 12px; align-items: end;">
              <div>
                <label style="display: block; margin-bottom: 6px; font-size: 13px; color: #64748B;" data-i18n="common:label_supplier">Proveedor</label>
                <select id="select-proveedor-nuevo" class="form-input" style="width: 100%;">
                  <option value="" data-i18n="ingredientes:suppliers_select">Seleccionar...</option>
                </select>
              </div>
              <div>
                <label style="display: block; margin-bottom: 6px; font-size: 13px; color: #64748B;" data-i18n="ingredientes:suppliers_label_price">Precio</label>
                <input type="number" id="input-precio-nuevo" class="form-input" placeholder="0.00" step="0.01" min="0"
                  style="width: 100%;">
              </div>
              <div>
                <button class="btn btn-primary" onclick="window.agregarProveedorIngrediente()"
                  style="padding: 10px 20px;">
                  <span data-i18n="ingredientes:suppliers_btn_add">‚ûï Agregar</span>
                </button>
              </div>
            </div>
          </div>

          <!-- Botones del modal -->
          <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button class="btn btn-secondary" onclick="window.cerrarModalProveedoresIngrediente()" data-i18n="common:btn_close">Cerrar</button>
          </div>
        </div>
      </div>

      <!-- Modal gestionar variantes de receta (botella/copa) -->
      <div id="modal-variantes-receta" class="modal">
        <div class="modal-content" style="max-width: 600px;">
          <h3 id="modal-variantes-titulo" data-i18n="recetas:variants_title">Variantes de la receta</h3>

          <!-- Lista de variantes -->
          <div style="margin: 20px 0;">
            <h4 style="color: #64748B; font-size: 14px; margin-bottom: 12px;" data-i18n="recetas:variants_formats">üç∑ FORMATOS DE VENTA</h4>
            <div id="lista-variantes" style="max-height: 300px; overflow-y: auto;">
              <!-- Se renderiza din√°micamente -->
            </div>
          </div>

          <!-- Formulario para agregar nueva variante -->
          <div style="background: #F8FAFC; padding: 20px; border-radius: 12px; margin-top: 20px;">
            <h4 style="color: #1E293B; font-size: 15px; margin-bottom: 16px;" data-i18n="recetas:variants_add">‚ûï A√±adir variante</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 12px; align-items: end;">
              <div>
                <label style="display: block; margin-bottom: 6px; font-size: 13px; color: #64748B;" data-i18n="recetas:variants_name">Nombre</label>
                <input type="text" id="input-variante-nombre" class="form-input" placeholder="Ej: Copa, Botella" data-i18n-placeholder="recetas:variants_name_placeholder"
                  style="width: 100%;">
              </div>
              <div>
                <label style="display: block; margin-bottom: 6px; font-size: 13px; color: #64748B;" data-i18n="recetas:variants_price">Precio ‚Ç¨</label>
                <input type="number" id="input-variante-precio" class="form-input" placeholder="0.00" step="0.01"
                  min="0" style="width: 100%;">
              </div>
              <div>
                <label style="display: block; margin-bottom: 6px; font-size: 13px; color: #64748B;" data-i18n="recetas:variants_factor">Factor</label>
                <input type="number" id="input-variante-factor" class="form-input" placeholder="1" step="0.1" min="0.1"
                  value="1" style="width: 100%;">
              </div>
              <div>
                <label style="display: block; margin-bottom: 6px; font-size: 13px; color: #64748B;" data-i18n="recetas:variants_code">C√≥digo TPV</label>
                <input type="text" id="input-variante-codigo" class="form-input" placeholder="Ej: 1272"
                  style="width: 100%;">
              </div>
            </div>
            <p style="font-size: 12px; color: #94A3B8; margin-top: 8px;">
              <span data-i18n="recetas:variants_factor_hint">üí° Factor = porci√≥n respecto a la unidad base (copa = 0.2, botella = 1) | C√≥digo TPV = ID del producto en
              el
              TPV</span>
            </p>
            <button class="btn btn-primary" onclick="window.agregarVarianteReceta()"
              style="margin-top: 12px; width: 100%;">
              <span data-i18n="recetas:variants_add_btn">‚ûï A√±adir Variante</span>
            </button>
          </div>

          <!-- Botones del modal -->
          <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button class="btn btn-secondary" onclick="window.cerrarModalVariantes()" data-i18n="common:btn_close">Cerrar</button>
          </div>
        </div>
      </div>

      <!-- Modal ver detalles pedido -->
      <div id="modal-ver-pedido" class="modal">
        <div class="modal-content" style="max-width: 800px;">
          <h3 data-i18n="pedidos:detail_modal_title">Detalles del Pedido</h3>
          <div id="modal-ver-pedido-contenido"></div>
          <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
            <button class="btn btn-secondary" data-action="cerrar-modal-pedido" data-i18n="common:btn_close">Cerrar</button>
            <button class="btn" style="background: #25D366; color: white;" onclick="window.enviarPedidoWhatsApp()">
              <span data-i18n="pedidos:btn_whatsapp">üì± WhatsApp</span>
            </button>
            <button class="btn btn-primary" data-action="descargar-pedido-pdf" id="btn-descargar-pdf">
              <span data-i18n="pedidos:btn_download_pdf">üìÑ Descargar PDF</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Modal recibir pedido -->
      <div id="modal-recibir-pedido" class="modal">
        <div class="modal-content" style="max-width: 900px;">
          <h3 data-i18n="pedidos:reception_title">Recibir Pedido</h3>
          <p style="margin-bottom: 20px; color: #666;" data-i18n="pedidos:reception_description">
            Verifica las cantidades y precios recibidos. Puedes ajustar los valores si hay diferencias.
          </p>

          <div style="background: #f8f8f8; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <strong data-i18n="pedidos:reception_supplier">Proveedor:</strong> <span id="modal-rec-proveedor"></span><br>
            <strong data-i18n="pedidos:reception_date">Fecha pedido:</strong> <span id="modal-rec-fecha"></span><br>
            <strong data-i18n="pedidos:reception_original_total">Total original:</strong> <span id="modal-rec-total-original"></span>
          </div>

          <div style="margin-bottom: 20px;">
            <h4 style="margin-bottom: 10px;" data-i18n="pedidos:reception_ingredients_title">Ingredientes del pedido:</h4>
            <table style="font-size: 13px;">
              <thead>
                <tr>
                  <th data-i18n="pedidos:reception_col_ingredient">Ingrediente</th>
                  <th data-i18n="pedidos:reception_col_ordered">Pedido</th>
                  <th data-i18n="pedidos:reception_col_received">Recibido</th>
                  <th data-i18n="pedidos:reception_col_price_ordered">Precio Ped.</th>
                  <th data-i18n="pedidos:reception_col_price_real">Precio Real</th>
                  <th data-i18n="pedidos:reception_col_subtotal">Subtotal</th>
                  <th data-i18n="pedidos:reception_col_status">Estado</th>
                </tr>
              </thead>
              <tbody id="modal-rec-items"></tbody>
            </table>
          </div>

          <div
            style="background: #f0fdf4; border: 2px solid #10b981; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
              <div>
                <strong style="color: #666;" data-i18n="pedidos:reception_total_original">Total Original:</strong><br>
                <span style="font-size: 20px; font-weight: bold; color: #333;" id="modal-rec-resumen-original">0.00
                  ‚Ç¨</span>
              </div>
              <div>
                <strong style="color: #666;" data-i18n="pedidos:reception_total_received">Total Recibido:</strong><br>
                <span style="font-size: 20px; font-weight: bold; color: #059669;" id="modal-rec-resumen-recibido">0.00
                  ‚Ç¨</span>
              </div>
              <div>
                <strong style="color: #666;" data-i18n="pedidos:reception_variance">Varianza:</strong><br>
                <span style="font-size: 20px; font-weight: bold;" id="modal-rec-resumen-varianza">0.00 ‚Ç¨</span>
              </div>
            </div>
          </div>

          <div style="display: flex; gap: 10px; justify-content: flex-end;">
            <button class="btn btn-secondary" data-action="cerrar-modal-recibir-pedido" data-i18n="common:btn_cancel">Cancelar</button>
            <button class="btn btn-success" data-action="confirmar-recepcion-pedido" data-i18n="pedidos:reception_confirm">Confirmar Recepci√≥n</button>
          </div>
        </div>
      </div>

      <script src="src/legacy/app-core.js"></script>
      <!-- Toast Container -->
      <div class="toast-container" id="toast-container"></div>

      <!-- Loading Overlay -->
      <div class="loading-overlay" id="loading-overlay">
        <div class="spinner"></div>
      </div>

      <!-- Modal: Evoluci√≥n de Precios -->
      <div id="modal-evolucion-precio" class="modal">
        <div class="modal-content" style="max-width: 700px;">
          <span class="close" data-action="cerrar-modal-evolucion-precio">&times;</span>
          <h2 style="color: #3b82f6; display: flex; align-items: center; gap: 10px;" data-i18n="ingredientes:price_evolution_modal_title">üìà Evoluci√≥n del Precio</h2>
          <p id="evolucion-ingrediente-nombre" style="color: #64748b; margin-bottom: 20px;"></p>

          <div id="evolucion-summary"
            style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 25px;">
          </div>

          <div style="height: 300px; background: #f8fafc; border-radius: 12px; padding: 20px;">
            <canvas id="chart-evolucion-precio"></canvas>
          </div>

          <div id="evolucion-tabla" style="margin-top: 20px; max-height: 200px; overflow-y: auto;">
          </div>

          <div style="margin-top: 20px; text-align: right;">
            <button class="btn btn-secondary" data-action="cerrar-modal-evolucion-precio" data-i18n="common:btn_close">Cerrar</button>
          </div>
        </div>
      </div>

      <!-- Modal: Confirmar Mermas Avanzado -->
      <div id="modal-confirmar-mermas" class="modal">
        <div class="modal-content" style="max-width: 800px;">
          <span class="close" data-action="cerrar-modal-mermas">&times;</span>
          <h2 style="color: #ef4444; display: flex; align-items: center; gap: 10px;" data-i18n="inventario:confirm_mermas_title">‚ö†Ô∏è Confirmar Mermas/P√©rdidas</h2>
          <p style="color: #64748b; margin-bottom: 20px;" data-i18n="inventario:confirm_mermas_desc">Se han detectado diferencias negativas en el inventario. Por
            favor, especifica el motivo de cada p√©rdida para el control de costes.</p>

          <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px;">
            <table style="width: 100%; border-collapse: collapse;">
              <thead style="background: #f8fafc; position: sticky; top: 0;">
                <tr>
                  <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;" data-i18n="inventario:confirm_mermas_col_ingredient">Ingrediente</th>
                  <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;" data-i18n="inventario:confirm_mermas_col_diff">Diferencia</th>
                  <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;" data-i18n="inventario:confirm_mermas_col_reason">Motivo</th>
                  <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;" data-i18n="inventario:confirm_mermas_col_notes">Notas</th>
                </tr>
              </thead>
              <tbody id="tabla-mermas-body">
                <!-- Se llena din√°micamente -->
              </tbody>
            </table>
          </div>

          <div id="mermas-alert-box"
            style="display:none; margin-top: 10px; padding: 10px; background: #fee2e2; color: #b91c1c; border-radius: 6px; font-size: 13px;">
          </div>

          <div style="margin-top: 20px; display: flex; justify-content: flex-end; gap: 10px;">
            <button class="btn btn-secondary" data-action="cerrar-modal-mermas" data-i18n="common:btn_cancel">Cancelar</button>
            <button class="btn btn-primary" id="btn-confirmar-split" style="background: #ef4444;"
              data-action="confirmar-mermas" data-i18n="inventario:confirm_mermas_btn">Confirmar Ajustes</button>
          </div>
        </div>
      </div>

      <!-- Modal: Historial de Mermas -->
      <div id="modal-historial-mermas" class="modal">
        <div class="modal-content" style="max-width: 900px; max-height: 90vh;">
          <span class="close" data-action="cerrar-modal-historial-mermas">&times;</span>
          <h2 style="color: #8B5CF6; display: flex; align-items: center; gap: 10px;" data-i18n="inventario:history_title">üìã Historial de Mermas/P√©rdidas
          </h2>
          <p style="color: #64748b; margin-bottom: 20px;" data-i18n="inventario:history_subtitle">Registro de todas las mermas y p√©rdidas registradas este mes.
          </p>

          <!-- Filtros -->
          <div style="display: flex; gap: 10px; margin-bottom: 20px; align-items: center;">
            <select id="mermas-mes" class="form-control"
              style="padding: 8px; border-radius: 8px; border: 1px solid #ddd;">
              <option value="1" data-i18n="dashboard:month_january">Enero</option>
              <option value="2" data-i18n="dashboard:month_february">Febrero</option>
              <option value="3" data-i18n="dashboard:month_march">Marzo</option>
              <option value="4" data-i18n="dashboard:month_april">Abril</option>
              <option value="5" data-i18n="dashboard:month_may">Mayo</option>
              <option value="6" data-i18n="dashboard:month_june">Junio</option>
              <option value="7" data-i18n="dashboard:month_july">Julio</option>
              <option value="8" data-i18n="dashboard:month_august">Agosto</option>
              <option value="9" data-i18n="dashboard:month_september">Septiembre</option>
              <option value="10" data-i18n="dashboard:month_october">Octubre</option>
              <option value="11" data-i18n="dashboard:month_november">Noviembre</option>
              <option value="12" data-i18n="dashboard:month_december">Diciembre</option>
            </select>
            <select id="mermas-ano" class="form-control"
              style="padding: 8px; border-radius: 8px; border: 1px solid #ddd;">
              <option value="2024">2024</option>
              <option value="2025">2025</option>
              <option value="2026" selected>2026</option>
            </select>
            <button class="btn btn-primary" onclick="window.cargarHistorialMermas()">üîÑ Cargar</button>
          </div>

          <!-- Resumen -->
          <div id="mermas-resumen"
            style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 20px;">
            <div
              style="background: linear-gradient(135deg, #fee2e2, #fecaca); padding: 15px; border-radius: 12px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #b91c1c;" id="mermas-total-valor">0.00‚Ç¨</div>
              <div style="font-size: 12px; color: #7f1d1d;" data-i18n="inventario:history_total_loss">P√©rdida Total</div>
            </div>
            <div
              style="background: linear-gradient(135deg, #e0e7ff, #c7d2fe); padding: 15px; border-radius: 12px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #4338ca;" id="mermas-total-registros">0</div>
              <div style="font-size: 12px; color: #3730a3;" data-i18n="inventario:history_records">Registros</div>
            </div>
            <div
              style="background: linear-gradient(135deg, #fef3c7, #fde68a); padding: 15px; border-radius: 12px; text-align: center;">
              <div style="font-size: 24px; font-weight: 700; color: #92400e;" id="mermas-motivo-principal">-</div>
              <div style="font-size: 12px; color: #78350f;" data-i18n="inventario:history_main_reason_label">Motivo Principal</div>
            </div>
          </div>

          <!-- Tabla -->
          <div style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px;">
            <table style="width: 100%; border-collapse: collapse;">
              <thead style="background: #f8fafc; position: sticky; top: 0;">
                <tr>
                  <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;" data-i18n="inventario:history_col_date">Fecha</th>
                  <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;" data-i18n="inventario:history_col_ingredient">Ingrediente</th>
                  <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;" data-i18n="inventario:history_col_quantity">Cantidad</th>
                  <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;" data-i18n="inventario:history_col_value">Valor</th>
                  <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;" data-i18n="inventario:history_col_reason">Motivo</th>
                  <th style="padding: 10px; text-align: left; border-bottom: 2px solid #e2e8f0;" data-i18n="inventario:history_col_note">Nota</th>
                </tr>
              </thead>
              <tbody id="tabla-historial-mermas-body">
                <tr>
                  <td colspan="6" style="text-align: center; padding: 40px; color: #94a3b8;" data-i18n="common:loading">Cargando...</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div style="margin-top: 20px; display: flex; justify-content: flex-end;">
            <button class="btn btn-secondary" data-action="cerrar-modal-historial-mermas" data-i18n="common:btn_close">Cerrar</button>
          </div>
        </div>
      </div>

      <!-- Modal: Registrar Mermas (Mejorado) -->
      <div id="modal-merma-rapida" class="modal">
        <div class="modal-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto;">
          <span class="close" data-action="cerrar-modal-merma-rapida">&times;</span>

          <!-- Header -->
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
            <div>
              <h2 style="color: #ef4444; display: flex; align-items: center; gap: 10px; margin: 0;">
                <span data-i18n="inventario:merma_control_title">üóëÔ∏è Control de Mermas</span>
              </h2>
              <p style="color: #64748b; margin: 5px 0 0; font-size: 14px;" data-i18n="inventario:merma_control_subtitle">
                Registra p√©rdidas de producto (caducidad, aver√≠as, etc.)
              </p>
            </div>
            <div style="text-align: right; color: #64748b; font-size: 13px;">
              <div id="merma-fecha-actual"></div>
            </div>
          </div>

          <!-- Responsable -->
          <div class="form-group" style="margin-bottom: 20px;">
            <label style="font-weight: 600;" data-i18n="inventario:merma_responsible">üë§ Responsable:</label>
            <select id="merma-responsable"
              style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
              <option value="" data-i18n="inventario:merma_select_responsible">Selecciona responsable...</option>
            </select>
          </div>

          <!-- Zona de escaneo de foto -->
          <div id="merma-dropzone" ondrop="window.procesarFotoMerma(event)"
            ondragover="event.preventDefault(); this.style.borderColor='#3b82f6'; this.style.background='#eff6ff';"
            ondragleave="this.style.borderColor='#cbd5e1'; this.style.background='#f8fafc';"
            style="background: #f8fafc; border: 2px dashed #cbd5e1; border-radius: 8px; padding: 20px; margin-bottom: 15px; text-align: center; cursor: pointer; transition: all 0.2s;"
            onclick="document.getElementById('merma-foto-input').click()">
            <input type="file" id="merma-foto-input" accept="image/*" style="display: none;"
              onchange="window.procesarFotoMermaInput(event)">
            <div id="merma-dropzone-content">
              <div style="font-size: 32px; margin-bottom: 8px;">üì∑</div>
              <div style="font-weight: 600; color: #334155;" data-i18n="inventario:merma_drop_photo">Arrastra una foto de la hoja de mermas</div>
              <div style="font-size: 12px; color: #64748b; margin-top: 4px;" data-i18n="inventario:merma_drop_click">o haz clic para seleccionar archivo</div>
            </div>
            <div id="merma-dropzone-loading" style="display: none;">
              <div style="font-size: 24px; margin-bottom: 8px;">‚è≥</div>
              <div style="font-weight: 600; color: #3b82f6;" data-i18n="inventario:merma_analyzing_image">Analizando imagen con IA...</div>
            </div>
          </div>

          <!-- L√≠neas de merma -->
          <div style="background: #f8fafc; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
              <span style="font-weight: 600; color: #334155;" data-i18n="inventario:merma_products_label">üìã Productos afectados</span>
              <button type="button" onclick="window.agregarLineaMerma()"
                style="background: #10b981; color: white; border: none; padding: 8px 16px; border-radius: 6px; cursor: pointer; font-size: 13px;">
                <span data-i18n="inventario:merma_add_product">+ A√±adir producto</span>
              </button>
            </div>

            <!-- Contenedor de l√≠neas -->
            <div id="merma-lineas-container">
              <!-- Las l√≠neas se a√±aden din√°micamente -->
            </div>
          </div>

          <!-- Resumen -->
          <div id="merma-resumen"
            style="display: none; background: linear-gradient(135deg, #fef3c7, #fde68a); border-radius: 8px; padding: 15px; margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
              <div>
                <span style="font-weight: 600; color: #92400e;" data-i18n="inventario:merma_summary">üìä Resumen de mermas</span>
                <div id="merma-resumen-detalle" style="color: #78350f; margin-top: 5px;"></div>
              </div>
              <div style="text-align: right;">
                <div style="font-size: 24px; font-weight: 700; color: #dc2626;" id="merma-total-perdida">0.00‚Ç¨</div>
                <div style="font-size: 12px; color: #92400e;" data-i18n="inventario:merma_total_loss">P√©rdida total</div>
              </div>
            </div>
          </div>

          <!-- Botones -->
          <div style="display: flex; justify-content: flex-end; gap: 10px;">
            <button class="btn btn-secondary" data-action="cerrar-modal-merma-rapida" data-i18n="common:btn_cancel">Cancelar</button>
            <button class="btn" style="background: #ef4444; color: white;" onclick="window.confirmarMermasMultiples()">
              <span data-i18n="inventario:merma_register_btn">üóëÔ∏è Registrar Mermas</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Modal: Actualizar Inventario Masivo -->
      <div id="modal-inventario-masivo" class="modal">
        <div class="modal-content" style="max-width: 900px;">
          <span class="close" data-action="cerrar-modal-inventario-masivo">&times;</span>
          <h2 data-i18n="inventario:massive_title">üìä Actualizar Inventario Masivo</h2>

          <div style="margin: 20px 0;">
            <p style="color: #64748b; margin-bottom: 15px;">
              Sube un archivo Excel (.xlsx) o CSV con las columnas: <strong>Ingrediente</strong> y <strong>Stock
                Real</strong>
            </p>

            <div style="display: flex; gap: 8px; justify-content: flex-end; flex-wrap: wrap; margin-bottom: 10px;">
              <button class="btn btn-small" style="background: #64748b; color: white;"
                data-action="descargar-plantilla-stock" data-i18n="inventario:massive_download_full">üì• Completo</button>
              <button class="btn btn-small" style="background: #10b981; color: white;"
                onclick="window.descargarPlantillaAlimentos()" data-i18n="inventario:massive_download_food">ü•ó Alimentos</button>
              <button class="btn btn-small" style="background: #3b82f6; color: white;"
                onclick="window.descargarPlantillaBebidas()" data-i18n="inventario:massive_download_drinks">üç∫ Bebidas</button>
            </div>

            <div
              style="border: 2px dashed #cbd5e1; border-radius: 8px; padding: 30px; text-align: center; background: #f8fafc;">
              <input type="file" id="file-inventario-masivo" accept=".xlsx,.csv" style="display: none;"
                onchange="window.procesarArchivoInventario(this)">
              <label for="file-inventario-masivo" style="cursor: pointer;">
                <div style="font-size: 48px; margin-bottom: 10px;">üìÅ</div>
                <div style="font-size: 16px; color: #475569; font-weight: 500;" data-i18n="inventario:massive_click_to_select">Haz clic para seleccionar archivo
                </div>
                <div style="font-size: 14px; color: #94a3b8; margin-top: 5px;" data-i18n="inventario:massive_file_types">Excel (.xlsx) o CSV</div>
              </label>
            </div>
          </div>

          <div id="preview-inventario-masivo" style="display: none; margin-top: 20px;">
            <h3 data-i18n="inventario:massive_preview_title">Vista Previa de Cambios</h3>
            <div id="preview-table-container"
              style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px;"></div>

            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
              <button class="btn btn-secondary" data-action="cancelar-inventario-masivo" data-i18n="common:btn_cancel">Cancelar</button>
              <button class="btn btn-primary" data-action="confirmar-inventario-masivo" id="btn-confirmar-masivo" data-i18n="inventario:massive_confirm_btn">‚úì
                Confirmar Actualizaci√≥n</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal: Importar Ingredientes -->
      <div id="modal-importar-ingredientes" class="modal">
        <div class="modal-content" style="max-width: 900px;">
          <span class="close" data-action="cerrar-modal-importar-ingredientes">&times;</span>
          <h2 data-i18n="ingredientes:import_modal_title">üì§ Importar Ingredientes desde Excel</h2>

          <div style="margin: 20px 0;">
            <p style="color: #64748b; margin-bottom: 15px;">
              Sube un archivo Excel (.xlsx) o CSV con las columnas: <strong>Nombre</strong>, <strong>Precio</strong>,
              <strong>Unidad</strong>, <strong>Stock Actual</strong>, <strong>Stock M√≠nimo</strong>
            </p>

            <div
              style="border: 2px dashed #cbd5e1; border-radius: 8px; padding: 30px; text-align: center; background: #f8fafc;">
              <input type="file" id="file-importar-ingredientes" accept=".xlsx,.csv" style="display: none;"
                onchange="window.procesarArchivoIngredientes(this)">
              <label for="file-importar-ingredientes" style="cursor: pointer;">
                <div style="font-size: 48px; margin-bottom: 10px;">üìÅ</div>
                <div style="font-size: 16px; color: #475569; font-weight: 500;" data-i18n="ingredientes:import_click_to_select">Haz clic para seleccionar archivo
                </div>
                <div style="font-size: 14px; color: #94a3b8; margin-top: 5px;" data-i18n="ingredientes:import_file_types">Excel (.xlsx) o CSV</div>
              </label>
            </div>
          </div>

          <div id="preview-importar-ingredientes" style="display: none; margin-top: 20px;">
            <h3 data-i18n="ingredientes:import_preview_title">Vista Previa de Ingredientes</h3>
            <div id="preview-ingredientes-container"
              style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px;"></div>

            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
              <button class="btn btn-secondary" data-action="cancelar-importar-ingredientes" data-i18n="common:btn_cancel">Cancelar</button>
              <button class="btn btn-primary" data-action="confirmar-importar-ingredientes"
                id="btn-confirmar-importar-ingredientes" data-i18n="ingredientes:import_confirm_btn">‚úì Importar Ingredientes</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal: Importar Recetas -->
      <div id="modal-importar-recetas" class="modal">
        <div class="modal-content" style="max-width: 900px;">
          <span class="close" data-action="cerrar-modal-importar-recetas">&times;</span>
          <h2 data-i18n="recetas:import_modal_title">üì§ Importar Recetas desde Excel</h2>

          <div style="margin: 20px 0;">
            <p style="color: #64748b; margin-bottom: 15px;">
              Sube un archivo Excel (.xlsx) o CSV con las columnas: <strong>Nombre</strong>,
              <strong>Categor√≠a</strong>,
              <strong>Precio Venta</strong>, <strong>Porciones</strong>
            </p>

            <div
              style="border: 2px dashed #cbd5e1; border-radius: 8px; padding: 30px; text-align: center; background: #f8fafc;">
              <input type="file" id="file-importar-recetas" accept=".xlsx,.csv" style="display: none;"
                onchange="window.procesarArchivoRecetas(this)">
              <label for="file-importar-recetas" style="cursor: pointer;">
                <div style="font-size: 48px; margin-bottom: 10px;">üìÅ</div>
                <div style="font-size: 16px; color: #475569; font-weight: 500;" data-i18n="recetas:import_click_to_select">Haz clic para seleccionar archivo
                </div>
                <div style="font-size: 14px; color: #94a3b8; margin-top: 5px;" data-i18n="recetas:import_file_types">Excel (.xlsx) o CSV</div>
              </label>
            </div>
          </div>

          <div id="preview-importar-recetas" style="display: none; margin-top: 20px;">
            <h3 data-i18n="recetas:import_preview_title">Vista Previa de Recetas</h3>
            <div id="preview-recetas-container"
              style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px;"></div>

            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
              <button class="btn btn-secondary" data-action="cancelar-importar-recetas" data-i18n="common:btn_cancel">Cancelar</button>
              <button class="btn btn-primary" data-action="confirmar-importar-recetas"
                id="btn-confirmar-importar-recetas" data-i18n="recetas:import_confirm_btn">‚úì
                Importar Recetas</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal: Importar Ventas TPV -->
      <div id="modal-importar-ventas" class="modal">
        <div class="modal-content" style="max-width: 900px;">
          <span class="close" data-action="cerrar-modal-importar-ventas">&times;</span>
          <h2 data-i18n="ventas:import_modal_title">üì§ Importar Ventas TPV</h2>

          <div style="margin: 20px 0;">
            <p style="color: #64748b; margin-bottom: 15px;">
              Sube un archivo <strong>PDF del TPV</strong>, Excel (.xlsx) o CSV con las columnas:
              <strong>C√≥digo</strong>
              (opcional),
              <strong>Nombre</strong>, <strong>Cantidad</strong>, <strong>Total</strong>
            </p>

            <!-- üìÖ Selector de fecha retroactiva -->
            <div
              style="background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%); border: 2px solid #f59e0b; border-radius: 12px; padding: 16px; margin-bottom: 20px;">
              <div style="display: flex; align-items: center; gap: 12px; flex-wrap: wrap;">
                <span style="font-size: 24px;">üìÖ</span>
                <div style="flex: 1; min-width: 200px;">
                  <label style="font-weight: 600; color: #92400e; font-size: 14px;" data-i18n="ventas:import_date_label">Fecha de las ventas:</label>
                  <p style="font-size: 12px; color: #b45309; margin: 2px 0 8px;" data-i18n="ventas:import_date_hint">Si dejas vac√≠o, se usa la fecha de hoy.
                    Usa
                    esto para importar ventas de d√≠as anteriores.</p>
                  <input type="date" id="fecha-importar-ventas"
                    style="padding: 10px 14px; border: 2px solid #f59e0b; border-radius: 8px; font-size: 14px; width: 100%; max-width: 200px; background: white;">
                </div>
              </div>
            </div>

            <div
              style="border: 2px dashed #cbd5e1; border-radius: 8px; padding: 30px; text-align: center; background: #f8fafc;">
              <input type="file" id="file-importar-ventas" accept=".pdf,.xlsx,.csv" style="display: none;"
                onchange="window.procesarArchivoVentas(this)">
              <label for="file-importar-ventas" style="cursor: pointer;">
                <div style="font-size: 48px; margin-bottom: 10px;">üìÅ</div>
                <div style="font-size: 16px; color: #475569; font-weight: 500;" data-i18n="ventas:import_click_to_select">Haz clic para seleccionar archivo
                </div>
                <div style="font-size: 14px; color: #94a3b8; margin-top: 5px;" data-i18n="ventas:import_file_types">üìÑ PDF del TPV, Excel (.xlsx) o CSV</div>
              </label>
            </div>
          </div>

          <div id="preview-importar-ventas" style="display: none; margin-top: 20px;">
            <h3 data-i18n="ventas:import_preview_title">Vista Previa de Ventas</h3>
            <div id="preview-ventas-container"
              style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px;"></div>

            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
              <button class="btn btn-secondary" data-action="cancelar-importar-ventas" data-i18n="common:btn_cancel">Cancelar</button>
              <button class="btn btn-primary" data-action="confirmar-importar-ventas"
                id="btn-confirmar-importar-ventas" data-i18n="ventas:import_confirm_btn">‚úì
                Importar Ventas</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Modal: Importar Pedidos (Compras) -->
      <div id="modal-importar-pedidos" class="modal">
        <div class="modal-content" style="max-width: 900px;">
          <span class="close" data-action="cerrar-modal-importar-pedidos">&times;</span>
          <h2 data-i18n="pedidos:import_modal_title">üì§ Importar Pedidos (Compras)</h2>

          <div style="margin: 20px 0;">
            <p style="color: #64748b; margin-bottom: 15px;">
              Sube un archivo Excel (.xlsx) o CSV con las columnas: <strong>Fecha</strong>,
              <strong>Proveedor</strong>,
              <strong>Ingrediente</strong>, <strong>Cantidad</strong>, <strong>Precio</strong>, <strong>Total</strong>
            </p>

            <div
              style="border: 2px dashed #cbd5e1; border-radius: 8px; padding: 30px; text-align: center; background: #f8fafc;">
              <input type="file" id="file-importar-pedidos" accept=".xlsx,.csv" style="display: none;"
                onchange="window.procesarArchivoPedidos(this)">
              <label for="file-importar-pedidos" style="cursor: pointer;">
                <div style="font-size: 48px; margin-bottom: 10px;">üìÅ</div>
                <div style="font-size: 16px; color: #475569; font-weight: 500;" data-i18n="pedidos:import_click_to_select">Haz clic para seleccionar archivo
                </div>
                <div style="font-size: 14px; color: #94a3b8; margin-top: 5px;" data-i18n="pedidos:import_file_types">Excel (.xlsx) o CSV</div>
              </label>
            </div>
          </div>

          <div id="preview-importar-pedidos" style="display: none; margin-top: 20px;">
            <h3 data-i18n="pedidos:import_preview_title">Vista Previa de Pedidos</h3>
            <div id="preview-pedidos-container"
              style="max-height: 400px; overflow-y: auto; border: 1px solid #e2e8f0; border-radius: 8px;"></div>

            <div style="margin-top: 20px; display: flex; gap: 10px; justify-content: flex-end;">
              <button class="btn btn-secondary" data-action="cancelar-importar-pedidos" data-i18n="common:btn_cancel">Cancelar</button>
              <button class="btn btn-primary" data-action="confirmar-importar-pedidos"
                id="btn-confirmar-importar-pedidos" data-i18n="pedidos:import_confirm_btn">‚úì
                Importar Pedidos</button>
            </div>
          </div>
        </div>
      </div>
      </script>
    </div>
    <script src="src/legacy/inventario-masivo.js"></script>

    <!-- CARRITO DE PEDIDOS - El c√≥digo est√° en src/modules/pedidos/pedidos-cart.js -->

    <!-- MODAL CARRITO DE PEDIDOS -->
    <div id="modal-carrito" class="modal">
      <div class="modal-content" style="max-width: 900px;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
          <h2 style="margin: 0; display: flex; align-items: center; gap: 10px;">
            <span data-i18n="pedidos:cart_modal_title">üõí Carrito de Pedidos</span>
          </h2>
          <button onclick="window.cerrarCarrito()"
            style="background: none; border: none; font-size: 24px; cursor: pointer; color: #64748b;">√ó</button>
        </div>

        <div id="carrito-contenido" style="min-height: 200px;">
          <!-- Se renderiza din√°micamente -->
        </div>

        <div
          style="display: flex; justify-content: space-between; align-items: center; margin-top: 20px; padding-top: 20px; border-top: 2px solid #e2e8f0;">
          <div>
            <span style="color: #64748b; font-size: 14px;" data-i18n="pedidos:cart_estimated_total">Total estimado:</span>
            <span id="carrito-total" style="font-size: 24px; font-weight: 700; color: #059669; margin-left: 10px;">0.00
              ‚Ç¨</span>
          </div>
          <div style="display: flex; gap: 10px;">
            <button onclick="window.vaciarCarrito()" class="btn btn-secondary"
              style="background: #fee2e2; color: #dc2626; border: none;">
              <span data-i18n="pedidos:cart_empty_btn">üóëÔ∏è Vaciar</span>
            </button>
            <button onclick="window.seguirComprando()" class="btn btn-primary"
              style="background: linear-gradient(135deg, #3B82F6, #2563EB);">
              <span data-i18n="pedidos:cart_add_more">‚ûï A√±adir m√°s productos</span>
            </button>
            <button onclick="window.confirmarCarrito()" class="btn btn-primary"
              style="background: linear-gradient(135deg, #10B981, #059669);" data-i18n="pedidos:cart_create_orders">
              ‚úÖ Crear Pedido(s)
            </button>
          </div>
        </div>
      </div>
    </div>
    <!-- MODAL DE CONFIRMACI√ìN PROFESIONAL -->
    <div id="modal-confirmacion" class="modal-overlay-custom" style="display: none;">
      <div class="modal-confirmacion-container">
        <div class="modal-confirmacion-content">
          <div class="modal-header-danger">
            <span class="modal-danger-icon">‚ö†Ô∏è</span>
            <h3 id="confirm-titulo" data-i18n="common:confirm_delete_title">Confirmar Eliminaci√≥n</h3>
          </div>
          <div class="modal-confirmacion-body">
            <p id="confirm-mensaje"></p>
          </div>
          <div class="modal-confirmacion-footer">
            <button class="btn-modal-cancel" data-action="cancelar-confirmacion" data-i18n="common:btn_cancel_with_icon">
              <span>‚úñ</span> Cancelar
            </button>
            <button class="btn-modal-danger" id="btn-confirmar-eliminar" data-i18n="common:btn_delete_with_icon">
              <span>üóëÔ∏è</span> Eliminar
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal Gasto Fijo -->
  <div id="modal-gasto-fijo" class="modal">
    <div class="modal-content">
      <span class="close" data-action="cerrar-form-gasto-fijo">&times;</span>
      <h2 id="titulo-modal-gasto" data-i18n="balance:gasto_fijo_title">A√±adir Gasto Fijo</h2>

      <form id="form-gasto-fijo" onsubmit="guardarGastoFijo(event)">
        <input type="hidden" id="gasto-id">

        <div class="form-group">
          <label for="gasto-concepto" data-i18n="balance:gasto_fijo_concept">Concepto *</label>
          <input type="text" id="gasto-concepto" required placeholder="ej: Alquiler, N√≥minas, Luz..." data-i18n-placeholder="balance:gasto_fijo_concept_placeholder">
        </div>

        <div class="form-group">
          <label for="gasto-monto" data-i18n="balance:gasto_fijo_amount">Monto Mensual (‚Ç¨) *</label>
          <input type="number" id="gasto-monto" step="0.01" min="0" required placeholder="0.00">
        </div>

        <div style="display:flex;gap:10px;margin-top:20px">
          <button type="submit" class="btn-primary" data-i18n="common:btn_save">Guardar</button>
          <button type="button" class="btn-secondary" data-action="cerrar-form-gasto-fijo" data-i18n="common:btn_cancel">Cancelar</button>
        </div>
      </form>
    </div>
  </div>
  </div> <!-- /main-content -->
  </div> <!-- /app-content -->

  <!-- Modal CSS: extra√≠do a styles/modals.css -->
  <script src="src/legacy/modales.js"></script>

  <!-- M√≥dulos ES6 - Se carga DESPU√âS del legacy para sobrescribirlo -->
  <script src="./src/modules/inteligencia/inteligencia-ui.js"></script>
  <script type="module" src="./src/main.js"></script>
</body>

</html>